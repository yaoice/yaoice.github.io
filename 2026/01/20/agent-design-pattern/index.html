<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    

    
    <meta property="og:site_name" content="çˆ±æŠ˜è…¾çš„å·¥ç¨‹å¸ˆ">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="https://www.iceyao.com.cn//img/post-bg-unix-linux.jpg">
    <meta property="twitter:image" content="https://www.iceyao.com.cn//img/post-bg-unix-linux.jpg" />
    

    
    <meta name="title" content="æ™ºèƒ½ä½“è®¾è®¡æ¨¡å¼å…¨é¢è§£æï¼šä»åŸºç¡€åˆ°é«˜çº§" />
    <meta property="og:title" content="æ™ºèƒ½ä½“è®¾è®¡æ¨¡å¼å…¨é¢è§£æï¼šä»åŸºç¡€åˆ°é«˜çº§" />
    <meta property="twitter:title" content="æ™ºèƒ½ä½“è®¾è®¡æ¨¡å¼å…¨é¢è§£æï¼šä»åŸºç¡€åˆ°é«˜çº§" />
    

    
    <meta name="description" content="æ™ºèƒ½ä½“è®¾è®¡æ¨¡å¼å…¨é¢è§£æï¼šä»åŸºç¡€åˆ°é«˜çº§">
    <meta property="og:description" content="æ™ºèƒ½ä½“è®¾è®¡æ¨¡å¼å…¨é¢è§£æï¼šä»åŸºç¡€åˆ°é«˜çº§" />
    <meta property="twitter:description" content="æ™ºèƒ½ä½“è®¾è®¡æ¨¡å¼å…¨é¢è§£æï¼šä»åŸºç¡€åˆ°é«˜çº§" />
    

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="iceyao, IceYao&#39;s Blog, åšå®¢, ä¸ªäººç½‘ç«™, äº’è”ç½‘, Web, äº‘åŸç”Ÿ, PaaS, Istio, Kubernetes, å¾®æœåŠ¡, Microservice">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>æ™ºèƒ½ä½“è®¾è®¡æ¨¡å¼å…¨é¢è§£æï¼šä»åŸºç¡€åˆ°é«˜çº§ | çˆ±æŠ˜è…¾çš„å·¥ç¨‹å¸ˆ | IceYao&#39;s Blog</title>

    <link rel="canonical" href="/2026/01/20/agent-design-pattern/">

    

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hugo-theme-cleanwhite.min.css">

    
    <link rel="stylesheet" href="/css/zanshang.css">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css">

    
    

    
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>

    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>

    
    <script src="/js/hux-blog.min.js"></script>

    
    <script src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script>

    
    

</head>



  
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-9J7CKFVPPM"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-9J7CKFVPPM');
        }
      </script>
    
  







<nav class="navbar navbar-default navbar-custom navbar-fixed-top">

    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">çˆ±æŠ˜è…¾çš„å·¥ç¨‹å¸ˆ</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">All Posts</a>
                    </li>
                    
                        
                    
                    
		    
                        <li><a href="/archive//">ARCHIVE</a></li>
                    
                        <li><a href="/notes//">NOTES</a></li>
                    
                        <li><a href="/about//">ABOUT</a></li>
                    
		            <li>
                        <a href="/search"><i class="fa fa-search"></i></a>
		           </li>
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('/img/post-bg-unix-linux.jpg')
    }
</style>

<header class="intro-header" >

    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/llm" title="LLM">
                            LLM
                        </a>
                        
                    </div>
                    <h1>æ™ºèƒ½ä½“è®¾è®¡æ¨¡å¼å…¨é¢è§£æï¼šä»åŸºç¡€åˆ°é«˜çº§</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        
                            Posted by 
                            
                                iceyao
                             
                            on 
                            Tuesday, January 20, 2026
                            
                            
                            
                            
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                
                <h1 id="æ™ºèƒ½ä½“è®¾è®¡æ¨¡å¼å…¨é¢è§£æä»åŸºç¡€åˆ°é«˜çº§">æ™ºèƒ½ä½“è®¾è®¡æ¨¡å¼å…¨é¢è§£æï¼šä»åŸºç¡€åˆ°é«˜çº§</h1>
<h2 id="å¼•è¨€">å¼•è¨€</h2>
<p>éšç€å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰æŠ€æœ¯çš„å¿«é€Ÿå‘å±•ï¼ŒAIæ™ºèƒ½ä½“ï¼ˆAgentï¼‰å·²æˆä¸ºæ„å»ºå¤æ‚AIåº”ç”¨çš„æ ¸å¿ƒèŒƒå¼ã€‚æ™ºèƒ½ä½“ä¸ä»…èƒ½å¤Ÿç†è§£å’Œç”Ÿæˆæ–‡æœ¬ï¼Œæ›´é‡è¦çš„æ˜¯èƒ½å¤Ÿè‡ªä¸»æ„ŸçŸ¥ç¯å¢ƒã€åˆ¶å®šè®¡åˆ’ã€æ‰§è¡Œè¡ŒåŠ¨ï¼Œå¹¶ä»ç»éªŒä¸­å­¦ä¹ æ”¹è¿›ã€‚</p>
<p>æœ¬æ–‡å°†å…¨é¢è§£æå½“å‰ä¸»æµçš„æ™ºèƒ½ä½“è®¾è®¡æ¨¡å¼ï¼Œä»åŸºç¡€çš„ReActæ¨¡å¼åˆ°é«˜çº§çš„å¤šæ™ºèƒ½ä½“åä½œæ¨¡å¼ï¼Œå¸®åŠ©å¼€å‘è€…æ·±å…¥ç†è§£å„ç§æ¨¡å¼çš„è®¾è®¡ç†å¿µã€å®ç°æœºåˆ¶å’Œé€‚ç”¨åœºæ™¯ã€‚</p>
<h3 id="æ™ºèƒ½ä½“çš„æ ¸å¿ƒèƒ½åŠ›">æ™ºèƒ½ä½“çš„æ ¸å¿ƒèƒ½åŠ›</h3>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">mindmap
  root((æ™ºèƒ½ä½“æ ¸å¿ƒèƒ½åŠ›))
    æ„ŸçŸ¥èƒ½åŠ›
      ç¯å¢ƒæ„ŸçŸ¥
      çŠ¶æ€è¯†åˆ«
      ä¿¡æ¯æå–
    æ¨ç†èƒ½åŠ›
      é€»è¾‘æ¨ç†
      å› æœåˆ†æ
      æ¨¡å¼è¯†åˆ«
    å†³ç­–èƒ½åŠ›
      ç›®æ ‡è®¾å®š
      ç­–ç•¥åˆ¶å®š
      è¡ŒåŠ¨é€‰æ‹©
    æ‰§è¡Œèƒ½åŠ›
      å·¥å…·è°ƒç”¨
      APIäº¤äº’
      ä»»åŠ¡æ‰§è¡Œ
    å­¦ä¹ èƒ½åŠ›
      ç»éªŒç§¯ç´¯
      çŸ¥è¯†æ›´æ–°
      ç­–ç•¥ä¼˜åŒ–
</code></pre><hr>
<h2 id="æ ¸å¿ƒè®¾è®¡æ¨¡å¼">æ ¸å¿ƒè®¾è®¡æ¨¡å¼</h2>
<h3 id="react-æ¨¡å¼">ReAct æ¨¡å¼</h3>
<h4 id="åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</h4>
<blockquote>
<p>[!info] ReAct å®šä¹‰
<strong>ReAct</strong>ï¼ˆReasoning + Actingï¼‰æ¨¡å¼æ˜¯æœ€åŸºç¡€ä¹Ÿæ˜¯æœ€é‡è¦çš„æ™ºèƒ½ä½“è®¾è®¡æ¨¡å¼ï¼Œç”±Googleåœ¨2022å¹´æå‡ºã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯å°†**æ¨ç†ï¼ˆReasoningï¼‰<strong>å’Œ</strong>è¡ŒåŠ¨ï¼ˆActingï¼‰**äº¤ç»‡åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªåŠ¨æ€çš„æ€è€ƒ-è¡ŒåŠ¨-è§‚å¯Ÿå¾ªç¯ã€‚</p>
</blockquote>
<h4 id="å·¥ä½œæµç¨‹">å·¥ä½œæµç¨‹</h4>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">graph TD
    A[å¼€å§‹ä»»åŠ¡] --&gt; B[Thought: åˆ†æå½“å‰çŠ¶æ€]
    B --&gt; C[Action: æ‰§è¡Œå…·ä½“è¡ŒåŠ¨]
    C --&gt; D[Observation: è·å–æ‰§è¡Œç»“æœ]
    D --&gt; E{ä»»åŠ¡å®Œæˆ?}
    E --&gt;|å¦| B
    E --&gt;|æ˜¯| F[è¾“å‡ºæœ€ç»ˆç»“æœ]
    
    style A fill:#f9f,stroke:#333,stroke-width:2px
    style F fill:#9f9,stroke:#333,stroke-width:2px
    style B fill:#bbf,stroke:#333,stroke-width:2px
    style C fill:#bfb,stroke:#333,stroke-width:2px
    style D fill:#ffb,stroke:#333,stroke-width:2px
</code></pre><h4 id="æ ¸å¿ƒç»„ä»¶è¯¦è§£">æ ¸å¿ƒç»„ä»¶è¯¦è§£</h4>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">graph LR
    subgraph &#34;ReAct æ ¸å¿ƒç»„ä»¶&#34;
        T[Thought æ€è€ƒå™¨]
        A[Action æ‰§è¡Œå™¨]
        O[Observation è§‚å¯Ÿå™¨]
    end
    
    T --&gt; |æ¨ç†ç»“æœ| A
    A --&gt; |æ‰§è¡Œç»“æœ| O
    O --&gt; |åé¦ˆä¿¡æ¯| T
    
    T -.-&gt; |åˆ†æä»»åŠ¡&lt;br/&gt;åˆ¶å®šç­–ç•¥&lt;br/&gt;é¢„æµ‹ç»“æœ| T
    A -.-&gt; |è°ƒç”¨å·¥å…·&lt;br/&gt;æ‰§è¡ŒAPI&lt;br/&gt;ç¯å¢ƒäº¤äº’| A
    O -.-&gt; |æ”¶é›†æ•°æ®&lt;br/&gt;åˆ†æåé¦ˆ&lt;br/&gt;çŠ¶æ€æ›´æ–°| O
</code></pre><h4 id="å®ç°ç¤ºä¾‹langgraph">å®ç°ç¤ºä¾‹ï¼ˆLangGraphï¼‰</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">from</span> typing <span style="color:#ff79c6">import</span> Annotated, TypedDict, Literal
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langgraph.graph <span style="color:#ff79c6">import</span> StateGraph, END
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langgraph.prebuilt <span style="color:#ff79c6">import</span> ToolNode
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langchain_core.messages <span style="color:#ff79c6">import</span> HumanMessage
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langchain_openai <span style="color:#ff79c6">import</span> ChatOpenAI
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># å®šä¹‰çŠ¶æ€ç±»å‹</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">AgentState</span>(TypedDict):
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;&#34;&#34;ReActæ™ºèƒ½ä½“çŠ¶æ€å®šä¹‰&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    messages: Annotated[<span style="color:#8be9fd;font-style:italic">list</span>, <span style="color:#f1fa8c">&#34;æ¶ˆæ¯å†å²ï¼ŒåŒ…å«æ‰€æœ‰å¯¹è¯å’Œå·¥å…·è°ƒç”¨è®°å½•&#34;</span>]
</span></span><span style="display:flex;"><span>    iteration: <span style="color:#8be9fd;font-style:italic">int</span>  <span style="color:#6272a4"># å½“å‰è¿­ä»£æ¬¡æ•°</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">create_react_agent</span>(tools: <span style="color:#8be9fd;font-style:italic">list</span>, max_iterations: <span style="color:#8be9fd;font-style:italic">int</span> <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">10</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    åˆ›å»ºReActæ¨¡å¼æ™ºèƒ½ä½“
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    Args:
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        tools: å¯ç”¨å·¥å…·åˆ—è¡¨
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        max_iterations: æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œé˜²æ­¢æ— é™å¾ªç¯
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    Returns:
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ç¼–è¯‘åçš„LangGraphå·¥ä½œæµ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># åˆå§‹åŒ–LLMå¹¶ç»‘å®šå·¥å…·ï¼Œä½¿æ¨¡å‹èƒ½å¤Ÿè°ƒç”¨å·¥å…·</span>
</span></span><span style="display:flex;"><span>    llm <span style="color:#ff79c6">=</span> ChatOpenAI(model<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;gpt-4&#34;</span>)<span style="color:#ff79c6">.</span>bind_tools(tools)
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># åˆ›å»ºå·¥å…·èŠ‚ç‚¹ï¼Œç”¨äºæ‰§è¡Œå·¥å…·è°ƒç”¨</span>
</span></span><span style="display:flex;"><span>    tool_node <span style="color:#ff79c6">=</span> ToolNode(tools)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">reasoning_node</span>(state: AgentState) <span style="color:#ff79c6">-&gt;</span> AgentState:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        Thoughté˜¶æ®µï¼šæ¨ç†å¹¶å†³å®šä¸‹ä¸€æ­¥è¡ŒåŠ¨
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        æ¨¡å‹åˆ†æå½“å‰æ¶ˆæ¯å†å²ï¼Œå†³å®šæ˜¯å¦éœ€è¦è°ƒç”¨å·¥å…·æˆ–ç›´æ¥å›ç­”
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        messages <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;messages&#34;</span>]
</span></span><span style="display:flex;"><span>        response <span style="color:#ff79c6">=</span> llm<span style="color:#ff79c6">.</span>invoke(messages)
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;messages&#34;</span>: messages <span style="color:#ff79c6">+</span> [response],
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;iteration&#34;</span>: state[<span style="color:#f1fa8c">&#34;iteration&#34;</span>] <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">should_continue</span>(state: AgentState) <span style="color:#ff79c6">-&gt;</span> Literal[<span style="color:#f1fa8c">&#34;tools&#34;</span>, <span style="color:#f1fa8c">&#34;end&#34;</span>]:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        è·¯ç”±å‡½æ•°ï¼šå†³å®šæ˜¯å¦ç»§ç»­æ‰§è¡Œæˆ–ç»“æŸ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        Returns:
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;tools&#34;: éœ€è¦æ‰§è¡Œå·¥å…·è°ƒç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;end&#34;: ä»»åŠ¡å®Œæˆæˆ–è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        last_message <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;messages&#34;</span>][<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># å®‰å…¨æ£€æŸ¥ï¼šé˜²æ­¢æ— é™å¾ªç¯</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> state[<span style="color:#f1fa8c">&#34;iteration&#34;</span>] <span style="color:#ff79c6">&gt;=</span> max_iterations:
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;end&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># æ£€æŸ¥æ˜¯å¦æœ‰å·¥å…·è°ƒç”¨è¯·æ±‚</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> <span style="color:#8be9fd;font-style:italic">hasattr</span>(last_message, <span style="color:#f1fa8c">&#34;tool_calls&#34;</span>) <span style="color:#ff79c6">and</span> last_message<span style="color:#ff79c6">.</span>tool_calls:
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;tools&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;end&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># ===== æ„å»ºçŠ¶æ€å›¾ =====</span>
</span></span><span style="display:flex;"><span>    workflow <span style="color:#ff79c6">=</span> StateGraph(AgentState)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># æ·»åŠ èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;reasoning&#34;</span>, reasoning_node)  <span style="color:#6272a4"># Thought: æ¨ç†èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;tools&#34;</span>, tool_node)           <span style="color:#6272a4"># Action + Observation: å·¥å…·æ‰§è¡ŒèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># è®¾ç½®å…¥å£ç‚¹</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>set_entry_point(<span style="color:#f1fa8c">&#34;reasoning&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># æ·»åŠ æ¡ä»¶è¾¹ï¼šæ ¹æ®æ¨ç†ç»“æœå†³å®šä¸‹ä¸€æ­¥</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_conditional_edges(
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;reasoning&#34;</span>,
</span></span><span style="display:flex;"><span>        should_continue,
</span></span><span style="display:flex;"><span>        {<span style="color:#f1fa8c">&#34;tools&#34;</span>: <span style="color:#f1fa8c">&#34;tools&#34;</span>, <span style="color:#f1fa8c">&#34;end&#34;</span>: END}
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># å·¥å…·æ‰§è¡Œåè¿”å›æ¨ç†èŠ‚ç‚¹ï¼Œå½¢æˆå¾ªç¯</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_edge(<span style="color:#f1fa8c">&#34;tools&#34;</span>, <span style="color:#f1fa8c">&#34;reasoning&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> workflow<span style="color:#ff79c6">.</span>compile()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># ä½¿ç”¨ç¤ºä¾‹</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">run_react_agent</span>(task: <span style="color:#8be9fd;font-style:italic">str</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">from</span> langchain_core.tools <span style="color:#ff79c6">import</span> tool
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    @tool
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">search</span>(query: <span style="color:#8be9fd;font-style:italic">str</span>) <span style="color:#ff79c6">-&gt;</span> <span style="color:#8be9fd;font-style:italic">str</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;æœç´¢ä¿¡æ¯&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;æœç´¢ç»“æœ: å…³äº&#39;</span><span style="color:#f1fa8c">{</span>query<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#39;çš„ç›¸å…³ä¿¡æ¯...&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    @tool
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">calculate</span>(expression: <span style="color:#8be9fd;font-style:italic">str</span>) <span style="color:#ff79c6">-&gt;</span> <span style="color:#8be9fd;font-style:italic">str</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;æ‰§è¡Œæ•°å­¦è®¡ç®—&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#8be9fd;font-style:italic">str</span>(<span style="color:#8be9fd;font-style:italic">eval</span>(expression))
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    agent <span style="color:#ff79c6">=</span> create_react_agent(tools<span style="color:#ff79c6">=</span>[search, calculate])
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    result <span style="color:#ff79c6">=</span> agent<span style="color:#ff79c6">.</span>invoke({
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;messages&#34;</span>: [HumanMessage(content<span style="color:#ff79c6">=</span>task)],
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;iteration&#34;</span>: <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> result[<span style="color:#f1fa8c">&#34;messages&#34;</span>][<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>]<span style="color:#ff79c6">.</span>content
</span></span></code></pre></div><h4 id="é€‚ç”¨åœºæ™¯">é€‚ç”¨åœºæ™¯</h4>
<table>
<thead>
<tr>
<th>åœºæ™¯ç±»å‹</th>
<th>æè¿°</th>
<th>ä¼˜åŠ¿</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>ğŸ” <strong>ä¿¡æ¯æ£€ç´¢</strong></td>
<td>éœ€è¦å¤šæ­¥æœç´¢å’Œåˆ†æ</td>
<td>åŠ¨æ€è°ƒæ•´æŸ¥è¯¢ç­–ç•¥</td>
<td>ç ”ç©¶æŠ¥å‘Šç”Ÿæˆã€äº‹å®æ ¸æŸ¥</td>
</tr>
<tr>
<td>ğŸ› <strong>é—®é¢˜è¯Šæ–­</strong></td>
<td>éœ€è¦é€æ­¥æ’æŸ¥é—®é¢˜</td>
<td>çµæ´»åº”å¯¹æœªçŸ¥æƒ…å†µ</td>
<td>ä»£ç è°ƒè¯•ã€ç³»ç»Ÿæ•…éšœæ’é™¤</td>
</tr>
<tr>
<td>ğŸ’¬ <strong>å¯¹è¯åŠ©æ‰‹</strong></td>
<td>å®æ—¶äº¤äº’å“åº”</td>
<td>ç®€å•é«˜æ•ˆçš„å¾ªç¯ç»“æ„</td>
<td>å®¢æœæœºå™¨äººã€ä¸ªäººåŠ©ç†</td>
</tr>
<tr>
<td>ğŸ“Š <strong>æ•°æ®åˆ†æ</strong></td>
<td>æ¢ç´¢æ€§æ•°æ®åˆ†æ</td>
<td>æ ¹æ®å‘ç°è°ƒæ•´åˆ†ææ–¹å‘</td>
<td>ä¸šåŠ¡æ´å¯Ÿã€è¶‹åŠ¿åˆ†æ</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="plan-and-execute-æ¨¡å¼">Plan-and-Execute æ¨¡å¼</h3>
<h4 id="åŸºæœ¬æ¦‚å¿µ-1">åŸºæœ¬æ¦‚å¿µ</h4>
<blockquote>
<p>[!info] Plan-and-Execute å®šä¹‰
<strong>Plan-and-Execute</strong>æ¨¡å¼é‡‡ç”¨&quot;å…ˆè§„åˆ’ï¼Œåæ‰§è¡Œ&quot;çš„ç­–ç•¥ï¼Œå°†å¤æ‚ä»»åŠ¡åˆ†è§£ä¸ºæœ‰åºçš„å­ä»»åŠ¡åºåˆ—ï¼Œç„¶åæŒ‰è®¡åˆ’é€æ­¥æ‰§è¡Œã€‚è¿™ç§æ¨¡å¼æ›´é€‚åˆéœ€è¦å…¨å±€è§„åˆ’å’Œèµ„æºåè°ƒçš„å¤æ‚ä»»åŠ¡ã€‚</p>
</blockquote>
<h4 id="æ¶æ„è®¾è®¡">æ¶æ„è®¾è®¡</h4>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">graph TB
    subgraph &#34;Plan-and-Execute æ¶æ„&#34;
        P[Planner è§„åˆ’å™¨]
        E[Executor æ‰§è¡Œå™¨]
        R[Re-planner é‡è§„åˆ’å™¨]
        M[Monitor ç›‘æ§å™¨]
    end
    
    Input[ä»»åŠ¡è¾“å…¥] --&gt; P
    P --&gt; |ç”Ÿæˆè®¡åˆ’| Queue[è®¡åˆ’é˜Ÿåˆ—]
    Queue --&gt; E
    E --&gt; |æ‰§è¡Œç»“æœ| M
    M --&gt; |éœ€è¦è°ƒæ•´| R
    M --&gt; |ç»§ç»­æ‰§è¡Œ| E
    R --&gt; |æ›´æ–°è®¡åˆ’| Queue
    E --&gt; |ä»»åŠ¡å®Œæˆ| Output[ç»“æœè¾“å‡º]
    
    style P fill:#e1f5fe
    style E fill:#e8f5e8
    style R fill:#fff3e0
    style M fill:#fce4ec
</code></pre><h4 id="è¯¦ç»†æ‰§è¡Œæµç¨‹">è¯¦ç»†æ‰§è¡Œæµç¨‹</h4>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">sequenceDiagram
    participant U as ç”¨æˆ·
    participant P as Planner
    participant E as Executor
    participant M as Monitor
    participant R as Re-planner
    
    U-&gt;&gt;P: æäº¤ä»»åŠ¡
    P-&gt;&gt;P: ä»»åŠ¡åˆ†æ
    P-&gt;&gt;P: ç”Ÿæˆæ‰§è¡Œè®¡åˆ’
    P-&gt;&gt;E: å‘é€è®¡åˆ’
    
    loop æ‰§è¡Œå¾ªç¯
        E-&gt;&gt;E: æ‰§è¡Œå½“å‰æ­¥éª¤
        E-&gt;&gt;M: æŠ¥å‘Šæ‰§è¡Œç»“æœ
        M-&gt;&gt;M: è¯„ä¼°æ‰§è¡ŒçŠ¶æ€
        
        alt éœ€è¦é‡æ–°è§„åˆ’
            M-&gt;&gt;R: è§¦å‘é‡è§„åˆ’
            R-&gt;&gt;R: åˆ†æé—®é¢˜
            R-&gt;&gt;P: æ›´æ–°è®¡åˆ’
            P-&gt;&gt;E: å‘é€æ–°è®¡åˆ’
        else ç»§ç»­æ‰§è¡Œ
            M-&gt;&gt;E: ç»§ç»­ä¸‹ä¸€æ­¥
        end
    end
    
    E-&gt;&gt;U: è¿”å›æœ€ç»ˆç»“æœ
</code></pre><h4 id="æ ¸å¿ƒç»„ä»¶å®ç°langgraph">æ ¸å¿ƒç»„ä»¶å®ç°ï¼ˆLangGraphï¼‰</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">from</span> typing <span style="color:#ff79c6">import</span> TypedDict, List, Optional, Literal
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> dataclasses <span style="color:#ff79c6">import</span> dataclass
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> enum <span style="color:#ff79c6">import</span> Enum
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langgraph.graph <span style="color:#ff79c6">import</span> StateGraph, END
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langchain_openai <span style="color:#ff79c6">import</span> ChatOpenAI
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langchain_core.messages <span style="color:#ff79c6">import</span> HumanMessage
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">StepStatus</span>(Enum):
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;&#34;&#34;è®¡åˆ’æ­¥éª¤çŠ¶æ€æšä¸¾&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    PENDING <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;pending&#34;</span>         <span style="color:#6272a4"># å¾…æ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>    IN_PROGRESS <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;in_progress&#34;</span> <span style="color:#6272a4"># æ‰§è¡Œä¸­</span>
</span></span><span style="display:flex;"><span>    COMPLETED <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;completed&#34;</span>     <span style="color:#6272a4"># å·²å®Œæˆ</span>
</span></span><span style="display:flex;"><span>    FAILED <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;failed&#34;</span>           <span style="color:#6272a4"># æ‰§è¡Œå¤±è´¥</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@dataclass
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">PlanStep</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;&#34;&#34;è®¡åˆ’æ­¥éª¤æ•°æ®ç±»&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">id</span>: <span style="color:#8be9fd;font-style:italic">int</span>                      <span style="color:#6272a4"># æ­¥éª¤ID</span>
</span></span><span style="display:flex;"><span>    description: <span style="color:#8be9fd;font-style:italic">str</span>             <span style="color:#6272a4"># æ­¥éª¤æè¿°</span>
</span></span><span style="display:flex;"><span>    tools: List[<span style="color:#8be9fd;font-style:italic">str</span>]             <span style="color:#6272a4"># æ‰€éœ€å·¥å…·</span>
</span></span><span style="display:flex;"><span>    dependencies: List[<span style="color:#8be9fd;font-style:italic">int</span>]      <span style="color:#6272a4"># ä¾èµ–çš„æ­¥éª¤ID</span>
</span></span><span style="display:flex;"><span>    status: StepStatus <span style="color:#ff79c6">=</span> StepStatus<span style="color:#ff79c6">.</span>PENDING
</span></span><span style="display:flex;"><span>    result: Optional[<span style="color:#8be9fd;font-style:italic">str</span>] <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># å®šä¹‰çŠ¶æ€ç±»å‹</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">PlanExecuteState</span>(TypedDict):
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;&#34;&#34;Plan-and-Executeæ™ºèƒ½ä½“çŠ¶æ€å®šä¹‰&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    task: <span style="color:#8be9fd;font-style:italic">str</span>                    <span style="color:#6272a4"># åŸå§‹ä»»åŠ¡</span>
</span></span><span style="display:flex;"><span>    plan: List[<span style="color:#8be9fd;font-style:italic">dict</span>]             <span style="color:#6272a4"># æ‰§è¡Œè®¡åˆ’ï¼ˆæ­¥éª¤åˆ—è¡¨ï¼‰</span>
</span></span><span style="display:flex;"><span>    current_step: <span style="color:#8be9fd;font-style:italic">int</span>            <span style="color:#6272a4"># å½“å‰æ‰§è¡Œåˆ°çš„æ­¥éª¤ç´¢å¼•</span>
</span></span><span style="display:flex;"><span>    results: List[<span style="color:#8be9fd;font-style:italic">str</span>]           <span style="color:#6272a4"># å„æ­¥éª¤æ‰§è¡Œç»“æœ</span>
</span></span><span style="display:flex;"><span>    final_result: Optional[<span style="color:#8be9fd;font-style:italic">str</span>]  <span style="color:#6272a4"># æœ€ç»ˆç»¼åˆç»“æœ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">create_plan_execute_agent</span>(tools: <span style="color:#8be9fd;font-style:italic">list</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    åˆ›å»ºPlan-and-Executeæ¨¡å¼æ™ºèƒ½ä½“
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    è¯¥æ¨¡å¼é‡‡ç”¨&#34;å…ˆè§„åˆ’ï¼Œåæ‰§è¡Œ&#34;çš„ç­–ç•¥ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    1. Planner: åˆ†æä»»åŠ¡ï¼Œç”Ÿæˆæ‰§è¡Œè®¡åˆ’
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    2. Executor: æŒ‰è®¡åˆ’é€æ­¥æ‰§è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    3. Re-planner: æ ¹æ®æ‰§è¡Œæƒ…å†µåŠ¨æ€è°ƒæ•´è®¡åˆ’
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    4. Synthesizer: ç»¼åˆæ‰€æœ‰ç»“æœç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    Args:
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        tools: å¯ç”¨å·¥å…·åˆ—è¡¨
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    Returns:
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ç¼–è¯‘åçš„LangGraphå·¥ä½œæµ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># è§„åˆ’å™¨ä½¿ç”¨ä½æ¸©åº¦ç¡®ä¿ç¨³å®šçš„è®¡åˆ’ç”Ÿæˆ</span>
</span></span><span style="display:flex;"><span>    planner_llm <span style="color:#ff79c6">=</span> ChatOpenAI(model<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;gpt-4&#34;</span>, temperature<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># æ‰§è¡Œå™¨ç»‘å®šå·¥å…·</span>
</span></span><span style="display:flex;"><span>    executor_llm <span style="color:#ff79c6">=</span> ChatOpenAI(model<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;gpt-4&#34;</span>)<span style="color:#ff79c6">.</span>bind_tools(tools)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">planning_node</span>(state: PlanExecuteState) <span style="color:#ff79c6">-&gt;</span> PlanExecuteState:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        è§„åˆ’é˜¶æ®µï¼šåˆ›å»ºæ‰§è¡Œè®¡åˆ’
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        å°†å¤æ‚ä»»åŠ¡åˆ†è§£ä¸ºæœ‰åºçš„å­ä»»åŠ¡åºåˆ—
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        task <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;task&#34;</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        plan_prompt <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        è¯·ä¸ºä»¥ä¸‹ä»»åŠ¡åˆ›å»ºè¯¦ç»†çš„æ‰§è¡Œè®¡åˆ’ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ä»»åŠ¡ï¼š</span><span style="color:#f1fa8c">{</span>task<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        è¦æ±‚ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        1. å°†ä»»åŠ¡åˆ†è§£ä¸º3-8ä¸ªå…·ä½“æ­¥éª¤
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        2. æ¯ä¸ªæ­¥éª¤åº”è¯¥æ˜¯å¯æ‰§è¡Œçš„åŸå­æ“ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        3. æ˜ç¡®æ­¥éª¤ä¹‹é—´çš„ä¾èµ–å…³ç³»
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        è¯·ä»¥JSONæ•°ç»„æ ¼å¼è¾“å‡ºï¼Œæ¯ä¸ªæ­¥éª¤åŒ…å«: id, description, dependencies
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        response <span style="color:#ff79c6">=</span> planner_llm<span style="color:#ff79c6">.</span>invoke([HumanMessage(content<span style="color:#ff79c6">=</span>plan_prompt)])
</span></span><span style="display:flex;"><span>        plan <span style="color:#ff79c6">=</span> json<span style="color:#ff79c6">.</span>loads(response<span style="color:#ff79c6">.</span>content)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> {<span style="color:#ff79c6">**</span>state, <span style="color:#f1fa8c">&#34;plan&#34;</span>: plan, <span style="color:#f1fa8c">&#34;current_step&#34;</span>: <span style="color:#bd93f9">0</span>, <span style="color:#f1fa8c">&#34;results&#34;</span>: []}
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">execution_node</span>(state: PlanExecuteState) <span style="color:#ff79c6">-&gt;</span> PlanExecuteState:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        æ‰§è¡Œé˜¶æ®µï¼šæ‰§è¡Œå½“å‰æ­¥éª¤
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        æ ¹æ®è®¡åˆ’æ‰§è¡Œå…·ä½“æ“ä½œï¼Œå¹¶æ”¶é›†æ‰§è¡Œç»“æœ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        plan <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;plan&#34;</span>]
</span></span><span style="display:flex;"><span>        current_step <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;current_step&#34;</span>]
</span></span><span style="display:flex;"><span>        results <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;results&#34;</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># è¾¹ç•Œæ£€æŸ¥</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> current_step <span style="color:#ff79c6">&gt;=</span> <span style="color:#8be9fd;font-style:italic">len</span>(plan):
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> state
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        step <span style="color:#ff79c6">=</span> plan[current_step]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># æ„å»ºæ‰§è¡Œä¸Šä¸‹æ–‡ï¼ŒåŒ…å«ä¹‹å‰çš„ç»“æœ</span>
</span></span><span style="display:flex;"><span>        exec_prompt <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        è¯·æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        æ­¥éª¤æè¿°ï¼š</span><span style="color:#f1fa8c">{</span>step[<span style="color:#f1fa8c">&#39;description&#39;</span>]<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ä¹‹å‰çš„æ‰§è¡Œç»“æœï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        </span><span style="color:#f1fa8c">{</span><span style="color:#8be9fd;font-style:italic">chr</span>(<span style="color:#bd93f9">10</span>)<span style="color:#ff79c6">.</span>join([<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;æ­¥éª¤</span><span style="color:#f1fa8c">{</span>i<span style="color:#ff79c6">+</span><span style="color:#bd93f9">1</span><span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">: </span><span style="color:#f1fa8c">{</span>r<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span> <span style="color:#ff79c6">for</span> i, r <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">enumerate</span>(results)])<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        response <span style="color:#ff79c6">=</span> executor_llm<span style="color:#ff79c6">.</span>invoke([HumanMessage(content<span style="color:#ff79c6">=</span>exec_prompt)])
</span></span><span style="display:flex;"><span>        new_results <span style="color:#ff79c6">=</span> results <span style="color:#ff79c6">+</span> [response<span style="color:#ff79c6">.</span>content]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> {<span style="color:#ff79c6">**</span>state, <span style="color:#f1fa8c">&#34;results&#34;</span>: new_results, <span style="color:#f1fa8c">&#34;current_step&#34;</span>: current_step <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>}
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">replan_node</span>(state: PlanExecuteState) <span style="color:#ff79c6">-&gt;</span> PlanExecuteState:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        é‡è§„åˆ’é˜¶æ®µï¼šæ ¹æ®æ‰§è¡Œç»“æœè°ƒæ•´è®¡åˆ’
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        å½“æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç°é—®é¢˜æˆ–æ–°ä¿¡æ¯æ—¶ï¼ŒåŠ¨æ€è°ƒæ•´å‰©ä½™è®¡åˆ’
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        task <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;task&#34;</span>]
</span></span><span style="display:flex;"><span>        results <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;results&#34;</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        replan_prompt <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        åŸå§‹ä»»åŠ¡ï¼š</span><span style="color:#f1fa8c">{</span>task<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        å·²å®Œæˆçš„æ­¥éª¤ç»“æœï¼š</span><span style="color:#f1fa8c">{</span>results<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        è¯·æ ¹æ®å½“å‰è¿›åº¦ï¼Œè¯„ä¼°æ˜¯å¦éœ€è¦è°ƒæ•´å‰©ä½™è®¡åˆ’ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        å¦‚éœ€è°ƒæ•´ï¼Œè¯·è¾“å‡ºæ–°çš„è®¡åˆ’æ­¥éª¤ï¼ˆJSONæ ¼å¼ï¼‰ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        å¦‚ä¸éœ€è¦è°ƒæ•´ï¼Œè¾“å‡º &#34;NO_REPLAN&#34;ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        response <span style="color:#ff79c6">=</span> planner_llm<span style="color:#ff79c6">.</span>invoke([HumanMessage(content<span style="color:#ff79c6">=</span>replan_prompt)])
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> <span style="color:#f1fa8c">&#34;NO_REPLAN&#34;</span> <span style="color:#ff79c6">not</span> <span style="color:#ff79c6">in</span> response<span style="color:#ff79c6">.</span>content:
</span></span><span style="display:flex;"><span>            new_plan <span style="color:#ff79c6">=</span> json<span style="color:#ff79c6">.</span>loads(response<span style="color:#ff79c6">.</span>content)
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> {<span style="color:#ff79c6">**</span>state, <span style="color:#f1fa8c">&#34;plan&#34;</span>: new_plan, <span style="color:#f1fa8c">&#34;current_step&#34;</span>: <span style="color:#bd93f9">0</span>}
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> state
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">synthesize_node</span>(state: PlanExecuteState) <span style="color:#ff79c6">-&gt;</span> PlanExecuteState:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ç»¼åˆé˜¶æ®µï¼šæ•´åˆæ‰€æœ‰ç»“æœ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        å°†å„æ­¥éª¤çš„æ‰§è¡Œç»“æœç»¼åˆä¸ºæœ€ç»ˆç­”æ¡ˆ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        task <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;task&#34;</span>]
</span></span><span style="display:flex;"><span>        results <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;results&#34;</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        synth_prompt <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ä»»åŠ¡ï¼š</span><span style="color:#f1fa8c">{</span>task<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        æ‰§è¡Œç»“æœï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        </span><span style="color:#f1fa8c">{</span><span style="color:#8be9fd;font-style:italic">chr</span>(<span style="color:#bd93f9">10</span>)<span style="color:#ff79c6">.</span>join([<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;æ­¥éª¤</span><span style="color:#f1fa8c">{</span>i<span style="color:#ff79c6">+</span><span style="color:#bd93f9">1</span><span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">: </span><span style="color:#f1fa8c">{</span>r<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span> <span style="color:#ff79c6">for</span> i, r <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">enumerate</span>(results)])<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        è¯·ç»¼åˆä»¥ä¸Šç»“æœï¼Œç»™å‡ºæœ€ç»ˆç­”æ¡ˆã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        response <span style="color:#ff79c6">=</span> planner_llm<span style="color:#ff79c6">.</span>invoke([HumanMessage(content<span style="color:#ff79c6">=</span>synth_prompt)])
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> {<span style="color:#ff79c6">**</span>state, <span style="color:#f1fa8c">&#34;final_result&#34;</span>: response<span style="color:#ff79c6">.</span>content}
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">should_continue</span>(state: PlanExecuteState) <span style="color:#ff79c6">-&gt;</span> Literal[<span style="color:#f1fa8c">&#34;execute&#34;</span>, <span style="color:#f1fa8c">&#34;replan&#34;</span>, <span style="color:#f1fa8c">&#34;synthesize&#34;</span>]:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        è·¯ç”±å‡½æ•°ï¼šå†³å®šä¸‹ä¸€æ­¥æ“ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        Returns:
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;execute&#34;: ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ­¥
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;replan&#34;: è§¦å‘é‡è§„åˆ’
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;synthesize&#34;: æ‰€æœ‰æ­¥éª¤å®Œæˆï¼Œè¿›å…¥ç»¼åˆé˜¶æ®µ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        current_step <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;current_step&#34;</span>]
</span></span><span style="display:flex;"><span>        plan <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;plan&#34;</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># æ‰€æœ‰æ­¥éª¤æ‰§è¡Œå®Œæ¯•</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> current_step <span style="color:#ff79c6">&gt;=</span> <span style="color:#8be9fd;font-style:italic">len</span>(plan):
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;synthesize&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># æ¯æ‰§è¡Œä¸¤æ­¥æ£€æŸ¥ä¸€æ¬¡æ˜¯å¦éœ€è¦é‡è§„åˆ’ï¼ˆå¯é…ç½®ï¼‰</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> current_step <span style="color:#ff79c6">&gt;</span> <span style="color:#bd93f9">0</span> <span style="color:#ff79c6">and</span> current_step <span style="color:#ff79c6">%</span> <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">0</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;replan&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;execute&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># ===== æ„å»ºçŠ¶æ€å›¾ =====</span>
</span></span><span style="display:flex;"><span>    workflow <span style="color:#ff79c6">=</span> StateGraph(PlanExecuteState)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># æ·»åŠ èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;plan&#34;</span>, planning_node)       <span style="color:#6272a4"># è§„åˆ’å™¨</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;execute&#34;</span>, execution_node)   <span style="color:#6272a4"># æ‰§è¡Œå™¨</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;replan&#34;</span>, replan_node)       <span style="color:#6272a4"># é‡è§„åˆ’å™¨</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;synthesize&#34;</span>, synthesize_node) <span style="color:#6272a4"># ç»¼åˆå™¨</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># è®¾ç½®å…¥å£ç‚¹</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>set_entry_point(<span style="color:#f1fa8c">&#34;plan&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># å®šä¹‰æ‰§è¡Œæµç¨‹</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_edge(<span style="color:#f1fa8c">&#34;plan&#34;</span>, <span style="color:#f1fa8c">&#34;execute&#34;</span>)  <span style="color:#6272a4"># è§„åˆ’å®Œæˆåå¼€å§‹æ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_conditional_edges(
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;execute&#34;</span>,
</span></span><span style="display:flex;"><span>        should_continue,
</span></span><span style="display:flex;"><span>        {<span style="color:#f1fa8c">&#34;execute&#34;</span>: <span style="color:#f1fa8c">&#34;execute&#34;</span>, <span style="color:#f1fa8c">&#34;replan&#34;</span>: <span style="color:#f1fa8c">&#34;replan&#34;</span>, <span style="color:#f1fa8c">&#34;synthesize&#34;</span>: <span style="color:#f1fa8c">&#34;synthesize&#34;</span>}
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_edge(<span style="color:#f1fa8c">&#34;replan&#34;</span>, <span style="color:#f1fa8c">&#34;execute&#34;</span>)  <span style="color:#6272a4"># é‡è§„åˆ’åç»§ç»­æ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_edge(<span style="color:#f1fa8c">&#34;synthesize&#34;</span>, END)    <span style="color:#6272a4"># ç»¼åˆåç»“æŸ</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> workflow<span style="color:#ff79c6">.</span>compile()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># ä½¿ç”¨ç¤ºä¾‹</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">run_plan_execute_agent</span>(task: <span style="color:#8be9fd;font-style:italic">str</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">from</span> langchain_core.tools <span style="color:#ff79c6">import</span> tool
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    @tool
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">search</span>(query: <span style="color:#8be9fd;font-style:italic">str</span>) <span style="color:#ff79c6">-&gt;</span> <span style="color:#8be9fd;font-style:italic">str</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;æœç´¢ä¿¡æ¯&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;æœç´¢ç»“æœ: </span><span style="color:#f1fa8c">{</span>query<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    @tool
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">write_file</span>(content: <span style="color:#8be9fd;font-style:italic">str</span>) <span style="color:#ff79c6">-&gt;</span> <span style="color:#8be9fd;font-style:italic">str</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;å†™å…¥æ–‡ä»¶&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;å·²å†™å…¥: </span><span style="color:#f1fa8c">{</span>content[:<span style="color:#bd93f9">50</span>]<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">...&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    agent <span style="color:#ff79c6">=</span> create_plan_execute_agent(tools<span style="color:#ff79c6">=</span>[search, write_file])
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    result <span style="color:#ff79c6">=</span> agent<span style="color:#ff79c6">.</span>invoke({
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;task&#34;</span>: task,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;plan&#34;</span>: [],
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;current_step&#34;</span>: <span style="color:#bd93f9">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;results&#34;</span>: [],
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;final_result&#34;</span>: <span style="color:#ff79c6">None</span>
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> result[<span style="color:#f1fa8c">&#34;final_result&#34;</span>]
</span></span></code></pre></div><h4 id="å¹¶è¡Œæ‰§è¡Œä¼˜åŒ–">å¹¶è¡Œæ‰§è¡Œä¼˜åŒ–</h4>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">gantt
    title Plan-and-Execute å¹¶è¡Œæ‰§è¡Œæ—¶é—´çº¿
    dateFormat X
    axisFormat %s
    
    section ä¸²è¡Œæ‰§è¡Œ
    Step 1    :s1, 0, 2
    Step 2    :s2, 2, 4
    Step 3    :s3, 4, 6
    Step 4    :s4, 6, 8
    Step 5    :s5, 8, 10
    
    section å¹¶è¡Œæ‰§è¡Œ
    Step 1    :p1, 0, 2
    Step 2    :p2, 2, 4
    Step 3    :p3, 2, 4
    Step 4    :p4, 4, 6
    Step 5    :p5, 4, 6
</code></pre><h4 id="é€‚ç”¨åœºæ™¯-1">é€‚ç”¨åœºæ™¯</h4>
<table>
<thead>
<tr>
<th>åœºæ™¯ç±»å‹</th>
<th>ç‰¹ç‚¹</th>
<th>ä¼˜åŠ¿</th>
<th>åº”ç”¨ç¤ºä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>ğŸ“Š <strong>æ•°æ®å¤„ç†æµæ°´çº¿</strong></td>
<td>æ­¥éª¤å›ºå®šï¼Œä¾èµ–æ˜ç¡®</td>
<td>èµ„æºé¢„åˆ†é…ï¼Œé«˜ååé‡</td>
<td>ETLæµç¨‹ã€æŠ¥è¡¨ç”Ÿæˆ</td>
</tr>
<tr>
<td>ğŸ—ï¸ <strong>é¡¹ç›®ç®¡ç†</strong></td>
<td>é˜¶æ®µæ€§å¼ºï¼Œéœ€è¦é‡Œç¨‹ç¢‘</td>
<td>è¿›åº¦å¯æ§ï¼Œä¾¿äºç®¡ç†</td>
<td>è½¯ä»¶å¼€å‘ã€äº§å“å‘å¸ƒ</td>
</tr>
<tr>
<td>ğŸ“ <strong>å†…å®¹åˆ›ä½œ</strong></td>
<td>åˆ›ä½œæµç¨‹æ ‡å‡†åŒ–</td>
<td>è´¨é‡ä¿è¯ï¼Œæµç¨‹è§„èŒƒ</td>
<td>æŠ€æœ¯æ–‡æ¡£ã€è¥é”€ææ–™</td>
</tr>
<tr>
<td>ğŸ”¬ <strong>ç§‘ç ”æµç¨‹</strong></td>
<td>ä¸¥æ ¼çš„æ–¹æ³•è®º</td>
<td>ç»“æœå¯å¤ç°ï¼Œè¿‡ç¨‹è§„èŒƒ</td>
<td>å®éªŒè®¾è®¡ã€è®ºæ–‡å†™ä½œ</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="ralph-loop-æ¨¡å¼">Ralph Loop æ¨¡å¼</h3>
<h4 id="åŸºæœ¬æ¦‚å¿µ-2">åŸºæœ¬æ¦‚å¿µ</h4>
<blockquote>
<p>[!important] Ralph Loop å®šä¹‰
<strong>Ralph Loop</strong>ï¼ˆReasoning-Acting-Learning-Planning Loopï¼‰æ˜¯æœ€é«˜çº§çš„æ™ºèƒ½ä½“è®¾è®¡æ¨¡å¼ï¼Œå®ƒå°†æ¨ç†ã€è¡ŒåŠ¨ã€å­¦ä¹ å’Œè§„åˆ’æ•´åˆæˆä¸€ä¸ªæŒç»­è¿­ä»£çš„é—­ç¯ç³»ç»Ÿã€‚è¯¥æ¨¡å¼çš„æ ¸å¿ƒç‰¹ç‚¹æ˜¯å…·å¤‡å­¦ä¹ å’Œè®°å¿†èƒ½åŠ›ï¼Œèƒ½å¤Ÿä»ç»éªŒä¸­ä¸æ–­æ”¹è¿›ã€‚</p>
</blockquote>
<h4 id="æ ¸å¿ƒæ¶æ„">æ ¸å¿ƒæ¶æ„</h4>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">graph TD
    subgraph &#34;Ralph Loop æ ¸å¿ƒæ¶æ„&#34;
        R[Reasoning æ¨ç†]
        A[Acting è¡ŒåŠ¨]
        L[Learning å­¦ä¹ ]
        P[Planning è§„åˆ’]
        
        KB[(Knowledge Base&lt;br/&gt;çŸ¥è¯†åº“)]
        EM[(Experience Memory&lt;br/&gt;ç»éªŒè®°å¿†)]
        
        R --&gt; A
        A --&gt; L
        L --&gt; P
        P --&gt; R
        
        R &lt;--&gt; KB
        L &lt;--&gt; EM
        P &lt;--&gt; KB
        A &lt;--&gt; EM
    end
    
    Env[Environment&lt;br/&gt;ç¯å¢ƒ] &lt;--&gt; A
    
    style R fill:#e3f2fd
    style A fill:#e8f5e8
    style L fill:#fff8e1
    style P fill:#fce4ec
    style KB fill:#f3e5f5
    style EM fill:#e0f2f1
</code></pre><h4 id="å››é˜¶æ®µè¯¦ç»†æµç¨‹">å››é˜¶æ®µè¯¦ç»†æµç¨‹</h4>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">flowchart TD
    subgraph &#34;Phase 1: Reasoning æ¨ç†é˜¶æ®µ&#34;
        R1[çŠ¶æ€è¯„ä¼°]
        R2[é—®é¢˜åˆ†æ]
        R3[å‡è®¾ç”Ÿæˆ]
        R4[ç­–ç•¥æ¨è]
        
        R1 --&gt; R2 --&gt; R3 --&gt; R4
    end
    
    subgraph &#34;Phase 2: Acting è¡ŒåŠ¨é˜¶æ®µ&#34;
        A1[åŠ¨ä½œé€‰æ‹©]
        A2[å‚æ•°ç»‘å®š]
        A3[æ‰§è¡ŒåŠ¨ä½œ]
        A4[æ”¶é›†åé¦ˆ]
        
        A1 --&gt; A2 --&gt; A3 --&gt; A4
    end
    
    subgraph &#34;Phase 3: Learning å­¦ä¹ é˜¶æ®µ&#34;
        L1[ç»éªŒæå–]
        L2[æ¨¡å¼è¯†åˆ«]
        L3[çŸ¥è¯†æ›´æ–°]
        L4[ç­–ç•¥ä¼˜åŒ–]
        
        L1 --&gt; L2 --&gt; L3 --&gt; L4
    end
    
    subgraph &#34;Phase 4: Planning è§„åˆ’é˜¶æ®µ&#34;
        P1[ç›®æ ‡è®¾å®š]
        P2[èµ„æºè¯„ä¼°]
        P3[ç­–ç•¥åˆ¶å®š]
        P4[è®¡åˆ’ç”Ÿæˆ]
        
        P1 --&gt; P2 --&gt; P3 --&gt; P4
    end
    
    R4 --&gt; A1
    A4 --&gt; L1
    L4 --&gt; P1
    P4 --&gt; R1
    
    style R1 fill:#e3f2fd
    style A1 fill:#e8f5e8
    style L1 fill:#fff8e1
    style P1 fill:#fce4ec
</code></pre><h4 id="çŸ¥è¯†åº“æ¶æ„">çŸ¥è¯†åº“æ¶æ„</h4>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">erDiagram
    KNOWLEDGE_BASE {
        string id PK
        string type
        string content
        float confidence
        datetime created_at
        datetime updated_at
    }
    
    FACTS {
        string fact_id PK
        string entity
        string relation
        string value
        float confidence
    }
    
    RULES {
        string rule_id PK
        string condition
        string action
        float success_rate
        int usage_count
    }
    
    PATTERNS {
        string pattern_id PK
        string context
        string pattern_type
        json parameters
        float effectiveness
    }
    
    EXPERIENCES {
        string exp_id PK
        string task_type
        json context
        json actions
        json outcomes
        float reward
    }
    
    KNOWLEDGE_BASE ||--o{ FACTS : contains
    KNOWLEDGE_BASE ||--o{ RULES : contains
    KNOWLEDGE_BASE ||--o{ PATTERNS : contains
    KNOWLEDGE_BASE ||--o{ EXPERIENCES : contains
</code></pre><h4 id="å­¦ä¹ æœºåˆ¶å®ç°langgraph">å­¦ä¹ æœºåˆ¶å®ç°ï¼ˆLangGraphï¼‰</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">from</span> typing <span style="color:#ff79c6">import</span> TypedDict, List, Optional, Literal
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> datetime <span style="color:#ff79c6">import</span> datetime
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langgraph.graph <span style="color:#ff79c6">import</span> StateGraph, END
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langchain_openai <span style="color:#ff79c6">import</span> ChatOpenAI
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langchain_core.messages <span style="color:#ff79c6">import</span> HumanMessage
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># å®šä¹‰çŠ¶æ€ç±»å‹</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">RalphState</span>(TypedDict):
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;&#34;&#34;Ralph Loopæ™ºèƒ½ä½“çŠ¶æ€å®šä¹‰&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    task: <span style="color:#8be9fd;font-style:italic">str</span>                              <span style="color:#6272a4"># åŸå§‹ä»»åŠ¡</span>
</span></span><span style="display:flex;"><span>    episode_count: <span style="color:#8be9fd;font-style:italic">int</span>                     <span style="color:#6272a4"># å½“å‰å›åˆæ•°</span>
</span></span><span style="display:flex;"><span>    max_episodes: <span style="color:#8be9fd;font-style:italic">int</span>                      <span style="color:#6272a4"># æœ€å¤§å›åˆæ•°</span>
</span></span><span style="display:flex;"><span>    reasoning_result: Optional[<span style="color:#8be9fd;font-style:italic">dict</span>]       <span style="color:#6272a4"># æ¨ç†é˜¶æ®µç»“æœ</span>
</span></span><span style="display:flex;"><span>    action_result: Optional[<span style="color:#8be9fd;font-style:italic">dict</span>]          <span style="color:#6272a4"># è¡ŒåŠ¨é˜¶æ®µç»“æœ</span>
</span></span><span style="display:flex;"><span>    learning_result: Optional[<span style="color:#8be9fd;font-style:italic">dict</span>]        <span style="color:#6272a4"># å­¦ä¹ é˜¶æ®µç»“æœ</span>
</span></span><span style="display:flex;"><span>    planning_result: Optional[<span style="color:#8be9fd;font-style:italic">dict</span>]        <span style="color:#6272a4"># è§„åˆ’é˜¶æ®µç»“æœ</span>
</span></span><span style="display:flex;"><span>    task_completed: <span style="color:#8be9fd;font-style:italic">bool</span>                   <span style="color:#6272a4"># ä»»åŠ¡æ˜¯å¦å®Œæˆ</span>
</span></span><span style="display:flex;"><span>    final_answer: Optional[<span style="color:#8be9fd;font-style:italic">str</span>]            <span style="color:#6272a4"># æœ€ç»ˆç­”æ¡ˆ</span>
</span></span><span style="display:flex;"><span>    knowledge_base: List[<span style="color:#8be9fd;font-style:italic">dict</span>]             <span style="color:#6272a4"># çŸ¥è¯†åº“ï¼ˆæŒä¹…åŒ–å­˜å‚¨ï¼‰</span>
</span></span><span style="display:flex;"><span>    experience_memory: List[<span style="color:#8be9fd;font-style:italic">dict</span>]          <span style="color:#6272a4"># ç»éªŒè®°å¿†ï¼ˆæƒ…æ™¯è®°å¿†ï¼‰</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">create_ralph_agent</span>(tools: <span style="color:#8be9fd;font-style:italic">list</span>, max_episodes: <span style="color:#8be9fd;font-style:italic">int</span> <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">10</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    åˆ›å»ºRalph Loopæ¨¡å¼æ™ºèƒ½ä½“
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    Ralph = Reasoning + Acting + Learning + Planning
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    è¿™æ˜¯ä¸€ä¸ªå…·æœ‰å­¦ä¹ èƒ½åŠ›çš„é«˜çº§æ™ºèƒ½ä½“æ¨¡å¼
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    Args:
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        tools: å¯ç”¨å·¥å…·åˆ—è¡¨ï¼ˆæœ¬ç¤ºä¾‹ä¸­æœªä½¿ç”¨ï¼Œå¯æ‰©å±•ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        max_episodes: æœ€å¤§å­¦ä¹ å›åˆæ•°
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    Returns:
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ç¼–è¯‘åçš„LangGraphå·¥ä½œæµ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    llm <span style="color:#ff79c6">=</span> ChatOpenAI(model<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;gpt-4&#34;</span>, temperature<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">reasoning_node</span>(state: RalphState) <span style="color:#ff79c6">-&gt;</span> RalphState:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        Phase 1: æ¨ç†é˜¶æ®µ (Reasoning)
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        èŒè´£ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        - è¯„ä¼°å½“å‰çŠ¶æ€
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        - åˆ†æé—®é¢˜æ ¸å¿ƒ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        - ç”Ÿæˆè§£å†³å‡è®¾
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        - æ¨èè¡ŒåŠ¨ç­–ç•¥
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        task <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;task&#34;</span>]
</span></span><span style="display:flex;"><span>        kb <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;knowledge_base&#34;</span>]
</span></span><span style="display:flex;"><span>        memory <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;experience_memory&#34;</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># æ£€ç´¢ç›¸å…³çŸ¥è¯†å’Œå†å²ç»éªŒï¼ˆç®€åŒ–ç‰ˆï¼Œå®é™…å¯ç”¨å‘é‡æ£€ç´¢ï¼‰</span>
</span></span><span style="display:flex;"><span>        relevant_knowledge <span style="color:#ff79c6">=</span> kb[<span style="color:#ff79c6">-</span><span style="color:#bd93f9">5</span>:] <span style="color:#ff79c6">if</span> kb <span style="color:#ff79c6">else</span> []
</span></span><span style="display:flex;"><span>        similar_experiences <span style="color:#ff79c6">=</span> memory[<span style="color:#ff79c6">-</span><span style="color:#bd93f9">3</span>:] <span style="color:#ff79c6">if</span> memory <span style="color:#ff79c6">else</span> []
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        prompt <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ä»»åŠ¡: </span><span style="color:#f1fa8c">{</span>task<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ç›¸å…³çŸ¥è¯†: </span><span style="color:#f1fa8c">{</span>json<span style="color:#ff79c6">.</span>dumps(relevant_knowledge, ensure_ascii<span style="color:#ff79c6">=</span><span style="color:#ff79c6">False</span>)<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ç±»ä¼¼ç»éªŒ: </span><span style="color:#f1fa8c">{</span>json<span style="color:#ff79c6">.</span>dumps(similar_experiences, ensure_ascii<span style="color:#ff79c6">=</span><span style="color:#ff79c6">False</span>)<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        è¯·è¿›è¡Œæ¨ç†åˆ†æï¼Œè¾“å‡ºJSONæ ¼å¼ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        </span><span style="color:#f1fa8c">{{</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;state_assessment&#34;: &#34;å½“å‰çŠ¶æ€è¯„ä¼°&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;problem_analysis&#34;: &#34;é—®é¢˜æ ¸å¿ƒåˆ†æ&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;hypotheses&#34;: [&#34;å‡è®¾1&#34;, &#34;å‡è®¾2&#34;],
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;recommended_action&#34;: &#34;æ¨èçš„è¡ŒåŠ¨ç­–ç•¥&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        </span><span style="color:#f1fa8c">}}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        response <span style="color:#ff79c6">=</span> llm<span style="color:#ff79c6">.</span>invoke([HumanMessage(content<span style="color:#ff79c6">=</span>prompt)])
</span></span><span style="display:flex;"><span>        reasoning <span style="color:#ff79c6">=</span> json<span style="color:#ff79c6">.</span>loads(response<span style="color:#ff79c6">.</span>content)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> {<span style="color:#ff79c6">**</span>state, <span style="color:#f1fa8c">&#34;reasoning_result&#34;</span>: reasoning}
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">acting_node</span>(state: RalphState) <span style="color:#ff79c6">-&gt;</span> RalphState:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        Phase 2: è¡ŒåŠ¨é˜¶æ®µ (Acting)
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        èŒè´£ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        - æ ¹æ®æ¨ç†ç»“æœé€‰æ‹©åŠ¨ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        - æ‰§è¡ŒåŠ¨ä½œå¹¶æ”¶é›†åé¦ˆ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        - è®°å½•æ‰§è¡Œä¸Šä¸‹æ–‡
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        task <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;task&#34;</span>]
</span></span><span style="display:flex;"><span>        reasoning <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;reasoning_result&#34;</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        prompt <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ä»»åŠ¡: </span><span style="color:#f1fa8c">{</span>task<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        æ¨ç†ç»“æœ: </span><span style="color:#f1fa8c">{</span>json<span style="color:#ff79c6">.</span>dumps(reasoning, ensure_ascii<span style="color:#ff79c6">=</span><span style="color:#ff79c6">False</span>)<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        è¯·æ‰§è¡Œæ¨èçš„è¡ŒåŠ¨ï¼Œè¾“å‡ºJSONæ ¼å¼ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        </span><span style="color:#f1fa8c">{{</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;action_taken&#34;: &#34;æ‰§è¡Œçš„åŠ¨ä½œ&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;parameters&#34;: </span><span style="color:#f1fa8c">{{}}</span><span style="color:#f1fa8c">,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;outcome&#34;: &#34;æ‰§è¡Œç»“æœ&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;success&#34;: true,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;context&#34;: &#34;æ‰§è¡Œä¸Šä¸‹æ–‡&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        </span><span style="color:#f1fa8c">}}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        response <span style="color:#ff79c6">=</span> llm<span style="color:#ff79c6">.</span>invoke([HumanMessage(content<span style="color:#ff79c6">=</span>prompt)])
</span></span><span style="display:flex;"><span>        action_result <span style="color:#ff79c6">=</span> json<span style="color:#ff79c6">.</span>loads(response<span style="color:#ff79c6">.</span>content)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> {<span style="color:#ff79c6">**</span>state, <span style="color:#f1fa8c">&#34;action_result&#34;</span>: action_result}
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">learning_node</span>(state: RalphState) <span style="color:#ff79c6">-&gt;</span> RalphState:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        Phase 3: å­¦ä¹ é˜¶æ®µ (Learning)
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        èŒè´£ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        - ä»æ‰§è¡Œç»“æœä¸­æå–ç»éªŒ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        - è¯†åˆ«è¡Œä¸ºæ¨¡å¼
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        - æ›´æ–°çŸ¥è¯†åº“
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        - ä¼˜åŒ–æ‰§è¡Œç­–ç•¥
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        action_result <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;action_result&#34;</span>]
</span></span><span style="display:flex;"><span>        kb <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;knowledge_base&#34;</span>]<span style="color:#ff79c6">.</span>copy()
</span></span><span style="display:flex;"><span>        memory <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;experience_memory&#34;</span>]<span style="color:#ff79c6">.</span>copy()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># æ„å»ºç»éªŒè®°å½•</span>
</span></span><span style="display:flex;"><span>        experience <span style="color:#ff79c6">=</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;context&#34;</span>: action_result<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">&#34;context&#34;</span>, <span style="color:#f1fa8c">&#34;&#34;</span>),
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;action&#34;</span>: action_result<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">&#34;action_taken&#34;</span>, <span style="color:#f1fa8c">&#34;&#34;</span>),
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;outcome&#34;</span>: action_result<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">&#34;outcome&#34;</span>, <span style="color:#f1fa8c">&#34;&#34;</span>),
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;success&#34;</span>: action_result<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">&#34;success&#34;</span>, <span style="color:#ff79c6">False</span>),
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;timestamp&#34;</span>: datetime<span style="color:#ff79c6">.</span>now()<span style="color:#ff79c6">.</span>isoformat()
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        memory<span style="color:#ff79c6">.</span>append(experience)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># è¯·æ±‚LLMè¯†åˆ«æ¨¡å¼å¹¶æå–çŸ¥è¯†</span>
</span></span><span style="display:flex;"><span>        prompt <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        æ ¹æ®ä»¥ä¸‹ç»éªŒï¼Œæå–å¯å­¦ä¹ çš„çŸ¥è¯†æ¨¡å¼ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        </span><span style="color:#f1fa8c">{</span>json<span style="color:#ff79c6">.</span>dumps(experience, ensure_ascii<span style="color:#ff79c6">=</span><span style="color:#ff79c6">False</span>)<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        è¾“å‡ºJSONæ ¼å¼ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        </span><span style="color:#f1fa8c">{{</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;patterns&#34;: [&#34;è¯†åˆ«çš„æ¨¡å¼&#34;],
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;new_knowledge&#34;: </span><span style="color:#f1fa8c">{{</span><span style="color:#f1fa8c">&#34;key&#34;: &#34;value&#34;</span><span style="color:#f1fa8c">}}</span><span style="color:#f1fa8c">,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;strategy_updates&#34;: [&#34;ç­–ç•¥æ›´æ–°å»ºè®®&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        </span><span style="color:#f1fa8c">}}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        response <span style="color:#ff79c6">=</span> llm<span style="color:#ff79c6">.</span>invoke([HumanMessage(content<span style="color:#ff79c6">=</span>prompt)])
</span></span><span style="display:flex;"><span>        learning <span style="color:#ff79c6">=</span> json<span style="color:#ff79c6">.</span>loads(response<span style="color:#ff79c6">.</span>content)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># å°†æ–°çŸ¥è¯†æ·»åŠ åˆ°çŸ¥è¯†åº“</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> learning<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">&#34;new_knowledge&#34;</span>):
</span></span><span style="display:flex;"><span>            kb<span style="color:#ff79c6">.</span>append(learning[<span style="color:#f1fa8c">&#34;new_knowledge&#34;</span>])
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">**</span>state,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;learning_result&#34;</span>: learning,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;knowledge_base&#34;</span>: kb,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;experience_memory&#34;</span>: memory
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">planning_node</span>(state: RalphState) <span style="color:#ff79c6">-&gt;</span> RalphState:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        Phase 4: è§„åˆ’é˜¶æ®µ (Planning)
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        èŒè´£ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        - æ ¹æ®å­¦ä¹ ç»“æœè®¾å®šä¸‹ä¸€æ­¥ç›®æ ‡
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        - åˆ¶å®šæ–°çš„æ‰§è¡Œç­–ç•¥
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        - è¯„ä¼°ä»»åŠ¡æ˜¯å¦å®Œæˆ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        task <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;task&#34;</span>]
</span></span><span style="display:flex;"><span>        learning <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;learning_result&#34;</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        prompt <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ä»»åŠ¡: </span><span style="color:#f1fa8c">{</span>task<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        å­¦ä¹ ç»“æœ: </span><span style="color:#f1fa8c">{</span>json<span style="color:#ff79c6">.</span>dumps(learning, ensure_ascii<span style="color:#ff79c6">=</span><span style="color:#ff79c6">False</span>)<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        åŸºäºå­¦ä¹ åˆ°çš„å†…å®¹ï¼Œåˆ¶å®šä¸‹ä¸€è½®çš„è®¡åˆ’ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        </span><span style="color:#f1fa8c">{{</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;goal&#34;: &#34;ä¸‹ä¸€æ­¥ç›®æ ‡&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;strategy&#34;: &#34;é‡‡ç”¨çš„ç­–ç•¥&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;expected_outcome&#34;: &#34;é¢„æœŸç»“æœ&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;task_completed&#34;: false
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        </span><span style="color:#f1fa8c">}}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        response <span style="color:#ff79c6">=</span> llm<span style="color:#ff79c6">.</span>invoke([HumanMessage(content<span style="color:#ff79c6">=</span>prompt)])
</span></span><span style="display:flex;"><span>        planning <span style="color:#ff79c6">=</span> json<span style="color:#ff79c6">.</span>loads(response<span style="color:#ff79c6">.</span>content)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">**</span>state,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;planning_result&#34;</span>: planning,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;task_completed&#34;</span>: planning<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">&#34;task_completed&#34;</span>, <span style="color:#ff79c6">False</span>)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">finalize_node</span>(state: RalphState) <span style="color:#ff79c6">-&gt;</span> RalphState:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆï¼Œç»¼åˆæ‰€æœ‰å­¦ä¹ ç»éªŒ&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        task <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;task&#34;</span>]
</span></span><span style="display:flex;"><span>        memory <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;experience_memory&#34;</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        prompt <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ä»»åŠ¡: </span><span style="color:#f1fa8c">{</span>task<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        å®Œæ•´æ‰§è¡Œå†å²: </span><span style="color:#f1fa8c">{</span>json<span style="color:#ff79c6">.</span>dumps(memory, ensure_ascii<span style="color:#ff79c6">=</span><span style="color:#ff79c6">False</span>)<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        è¯·ç»¼åˆæ‰€æœ‰ç»éªŒï¼Œç”Ÿæˆæœ€ç»ˆç­”æ¡ˆã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        response <span style="color:#ff79c6">=</span> llm<span style="color:#ff79c6">.</span>invoke([HumanMessage(content<span style="color:#ff79c6">=</span>prompt)])
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> {<span style="color:#ff79c6">**</span>state, <span style="color:#f1fa8c">&#34;final_answer&#34;</span>: response<span style="color:#ff79c6">.</span>content}
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">should_continue</span>(state: RalphState) <span style="color:#ff79c6">-&gt;</span> Literal[<span style="color:#f1fa8c">&#34;reasoning&#34;</span>, <span style="color:#f1fa8c">&#34;finalize&#34;</span>]:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;è·¯ç”±å‡½æ•°ï¼šå†³å®šæ˜¯å¦ç»§ç»­Ralphå¾ªç¯&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> state[<span style="color:#f1fa8c">&#34;task_completed&#34;</span>]:
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;finalize&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> state[<span style="color:#f1fa8c">&#34;episode_count&#34;</span>] <span style="color:#ff79c6">&gt;=</span> state[<span style="color:#f1fa8c">&#34;max_episodes&#34;</span>]:
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;finalize&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;reasoning&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">increment_episode</span>(state: RalphState) <span style="color:#ff79c6">-&gt;</span> RalphState:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;å›åˆè®¡æ•°å™¨ï¼Œç”¨äºè·Ÿè¸ªå­¦ä¹ è¿›åº¦&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> {<span style="color:#ff79c6">**</span>state, <span style="color:#f1fa8c">&#34;episode_count&#34;</span>: state[<span style="color:#f1fa8c">&#34;episode_count&#34;</span>] <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>}
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># ===== æ„å»ºçŠ¶æ€å›¾ =====</span>
</span></span><span style="display:flex;"><span>    workflow <span style="color:#ff79c6">=</span> StateGraph(RalphState)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># æ·»åŠ Ralphå››é˜¶æ®µèŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;reasoning&#34;</span>, reasoning_node)    <span style="color:#6272a4"># R - æ¨ç†</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;acting&#34;</span>, acting_node)          <span style="color:#6272a4"># A - è¡ŒåŠ¨</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;learning&#34;</span>, learning_node)      <span style="color:#6272a4"># L - å­¦ä¹ </span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;planning&#34;</span>, planning_node)      <span style="color:#6272a4"># P - è§„åˆ’</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;increment&#34;</span>, increment_episode) <span style="color:#6272a4"># å›åˆè®¡æ•°</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;finalize&#34;</span>, finalize_node)      <span style="color:#6272a4"># æœ€ç»ˆè¾“å‡º</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># è®¾ç½®å…¥å£ç‚¹</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>set_entry_point(<span style="color:#f1fa8c">&#34;reasoning&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># å®šä¹‰Ralphå¾ªç¯è¾¹: R -&gt; A -&gt; L -&gt; P -&gt; increment</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_edge(<span style="color:#f1fa8c">&#34;reasoning&#34;</span>, <span style="color:#f1fa8c">&#34;acting&#34;</span>)
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_edge(<span style="color:#f1fa8c">&#34;acting&#34;</span>, <span style="color:#f1fa8c">&#34;learning&#34;</span>)
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_edge(<span style="color:#f1fa8c">&#34;learning&#34;</span>, <span style="color:#f1fa8c">&#34;planning&#34;</span>)
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_edge(<span style="color:#f1fa8c">&#34;planning&#34;</span>, <span style="color:#f1fa8c">&#34;increment&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># æ¡ä»¶è¾¹ï¼šç»§ç»­å¾ªç¯æˆ–ç»“æŸ</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_conditional_edges(
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;increment&#34;</span>,
</span></span><span style="display:flex;"><span>        should_continue,
</span></span><span style="display:flex;"><span>        {<span style="color:#f1fa8c">&#34;reasoning&#34;</span>: <span style="color:#f1fa8c">&#34;reasoning&#34;</span>, <span style="color:#f1fa8c">&#34;finalize&#34;</span>: <span style="color:#f1fa8c">&#34;finalize&#34;</span>}
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_edge(<span style="color:#f1fa8c">&#34;finalize&#34;</span>, END)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> workflow<span style="color:#ff79c6">.</span>compile()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># ä½¿ç”¨ç¤ºä¾‹</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">run_ralph_agent</span>(task: <span style="color:#8be9fd;font-style:italic">str</span>):
</span></span><span style="display:flex;"><span>    agent <span style="color:#ff79c6">=</span> create_ralph_agent(tools<span style="color:#ff79c6">=</span>[], max_episodes<span style="color:#ff79c6">=</span><span style="color:#bd93f9">5</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    result <span style="color:#ff79c6">=</span> agent<span style="color:#ff79c6">.</span>invoke({
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;task&#34;</span>: task,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;episode_count&#34;</span>: <span style="color:#bd93f9">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;max_episodes&#34;</span>: <span style="color:#bd93f9">5</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;reasoning_result&#34;</span>: <span style="color:#ff79c6">None</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;action_result&#34;</span>: <span style="color:#ff79c6">None</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;learning_result&#34;</span>: <span style="color:#ff79c6">None</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;planning_result&#34;</span>: <span style="color:#ff79c6">None</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;task_completed&#34;</span>: <span style="color:#ff79c6">False</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;final_answer&#34;</span>: <span style="color:#ff79c6">None</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;knowledge_base&#34;</span>: [],
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;experience_memory&#34;</span>: []
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> result[<span style="color:#f1fa8c">&#34;final_answer&#34;</span>]
</span></span></code></pre></div><h4 id="è‡ªé€‚åº”å­¦ä¹ æµç¨‹">è‡ªé€‚åº”å­¦ä¹ æµç¨‹</h4>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">graph LR
    subgraph &#34;è‡ªé€‚åº”å­¦ä¹ å¾ªç¯&#34;
        E[Experience&lt;br/&gt;ç»éªŒæ”¶é›†]
        P[Pattern&lt;br/&gt;æ¨¡å¼è¯†åˆ«]
        K[Knowledge&lt;br/&gt;çŸ¥è¯†æŠ½å–]
        S[Strategy&lt;br/&gt;ç­–ç•¥ä¼˜åŒ–]
        
        E --&gt; P
        P --&gt; K
        K --&gt; S
        S --&gt; E
    end
    
    subgraph &#34;å­¦ä¹ æœºåˆ¶&#34;
        RL[å¼ºåŒ–å­¦ä¹ ]
        IL[æ¨¡ä»¿å­¦ä¹ ]
        ML[å…ƒå­¦ä¹ ]
        TL[è¿ç§»å­¦ä¹ ]
    end
    
    E -.-&gt; RL
    P -.-&gt; IL
    K -.-&gt; ML
    S -.-&gt; TL
</code></pre><h4 id="é€‚ç”¨åœºæ™¯-2">é€‚ç”¨åœºæ™¯</h4>
<table>
<thead>
<tr>
<th>åœºæ™¯ç±»å‹</th>
<th>ç‰¹ç‚¹</th>
<th>ä¼˜åŠ¿</th>
<th>åº”ç”¨ç¤ºä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>ğŸ“ <strong>æ™ºèƒ½æ•™è‚²</strong></td>
<td>éœ€è¦ä¸ªæ€§åŒ–é€‚åº”</td>
<td>æŒç»­å­¦ä¹ ç”¨æˆ·åå¥½</td>
<td>è‡ªé€‚åº”å­¦ä¹ ç³»ç»Ÿã€æ™ºèƒ½å¯¼å¸ˆ</td>
</tr>
<tr>
<td>ğŸ¤– <strong>ä¸ªäººåŠ©æ‰‹</strong></td>
<td>é•¿æœŸäº¤äº’å…³ç³»</td>
<td>äº†è§£ç”¨æˆ·ä¹ æƒ¯å’Œéœ€æ±‚</td>
<td>æ™ºèƒ½ç§˜ä¹¦ã€ç”Ÿæ´»åŠ©ç†</td>
</tr>
<tr>
<td>ğŸ”¬ <strong>è‡ªåŠ¨åŒ–ç ”ç©¶</strong></td>
<td>æ¢ç´¢æœªçŸ¥é¢†åŸŸ</td>
<td>ç§¯ç´¯ç ”ç©¶ç»éªŒå’Œæ–¹æ³•</td>
<td>ç§‘å­¦å‘ç°ã€è¯ç‰©ç ”å‘</td>
</tr>
<tr>
<td>ğŸ® <strong>æ¸¸æˆAI</strong></td>
<td>å¯¹æ‰‹ç­–ç•¥å˜åŒ–</td>
<td>é€‚åº”ä¸åŒç©å®¶é£æ ¼</td>
<td>æ™ºèƒ½NPCã€æ¸¸æˆå¹³è¡¡</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="æ‰©å±•è®¾è®¡æ¨¡å¼">æ‰©å±•è®¾è®¡æ¨¡å¼</h2>
<h3 id="chain-of-thought-æ¨¡å¼">Chain-of-Thought æ¨¡å¼</h3>
<h4 id="åŸºæœ¬æ¦‚å¿µ-3">åŸºæœ¬æ¦‚å¿µ</h4>
<blockquote>
<p>[!tip] Chain-of-Thought å®šä¹‰
**Chain-of-Thought (CoT)**æ¨¡å¼é€šè¿‡å¼•å¯¼æ¨¡å‹å±•ç¤ºè¯¦ç»†çš„æ¨ç†æ­¥éª¤æ¥æé«˜å¤æ‚é—®é¢˜çš„è§£å†³èƒ½åŠ›ã€‚å®ƒä¸æ˜¯ç›´æ¥ç»™å‡ºç­”æ¡ˆï¼Œè€Œæ˜¯é€æ­¥å±•ç¤ºæ€è€ƒè¿‡ç¨‹ã€‚</p>
</blockquote>
<h4 id="æ¨ç†é“¾ç»“æ„">æ¨ç†é“¾ç»“æ„</h4>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">graph TD
    Q[é—®é¢˜è¾“å…¥] --&gt; S1[æ¨ç†æ­¥éª¤1]
    S1 --&gt; S2[æ¨ç†æ­¥éª¤2]
    S2 --&gt; S3[æ¨ç†æ­¥éª¤3]
    S3 --&gt; Sn[æ¨ç†æ­¥éª¤n]
    Sn --&gt; A[æœ€ç»ˆç­”æ¡ˆ]
    
    subgraph &#34;æ¨ç†ç±»å‹&#34;
        L[é€»è¾‘æ¨ç†]
        M[æ•°å­¦è®¡ç®—]
        C[å› æœåˆ†æ]
        A1[ç±»æ¯”æ¨ç†]
    end
    
    style Q fill:#f9f9f9
    style A fill:#e8f5e8
</code></pre><h4 id="å®ç°ç¤ºä¾‹langgraph-1">å®ç°ç¤ºä¾‹ï¼ˆLangGraphï¼‰</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">from</span> typing <span style="color:#ff79c6">import</span> TypedDict, List, Literal
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langgraph.graph <span style="color:#ff79c6">import</span> StateGraph, END
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langchain_openai <span style="color:#ff79c6">import</span> ChatOpenAI
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langchain_core.messages <span style="color:#ff79c6">import</span> HumanMessage
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># å®šä¹‰çŠ¶æ€ç±»å‹</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">CoTState</span>(TypedDict):
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;&#34;&#34;Chain-of-Thoughtæ™ºèƒ½ä½“çŠ¶æ€å®šä¹‰&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    problem: <span style="color:#8be9fd;font-style:italic">str</span>           <span style="color:#6272a4"># å¾…è§£å†³çš„é—®é¢˜</span>
</span></span><span style="display:flex;"><span>    steps: List[<span style="color:#8be9fd;font-style:italic">str</span>]       <span style="color:#6272a4"># æ¨ç†æ­¥éª¤åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>    current_step: <span style="color:#8be9fd;font-style:italic">int</span>      <span style="color:#6272a4"># å½“å‰æ¨ç†æ­¥éª¤ç´¢å¼•</span>
</span></span><span style="display:flex;"><span>    final_answer: <span style="color:#8be9fd;font-style:italic">str</span>      <span style="color:#6272a4"># æœ€ç»ˆç­”æ¡ˆ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">create_cot_agent</span>(max_steps: <span style="color:#8be9fd;font-style:italic">int</span> <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">5</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    åˆ›å»ºChain-of-Thoughtæ¨¡å¼æ™ºèƒ½ä½“
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    é€šè¿‡å¼•å¯¼æ¨¡å‹é€æ­¥å±•ç¤ºæ¨ç†è¿‡ç¨‹æ¥æé«˜å¤æ‚é—®é¢˜çš„è§£å†³èƒ½åŠ›
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    æ¯ä¸€æ­¥éƒ½ä¼šåŸºäºä¹‹å‰çš„æ¨ç†ç»“æœè¿›è¡Œä¸‹ä¸€æ­¥åˆ†æ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    Args:
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        max_steps: æœ€å¤§æ¨ç†æ­¥éª¤æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    Returns:
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ç¼–è¯‘åçš„LangGraphå·¥ä½œæµ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    llm <span style="color:#ff79c6">=</span> ChatOpenAI(model<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;gpt-4&#34;</span>, temperature<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># é¢„å®šä¹‰çš„æ¨ç†æ­¥éª¤å¼•å¯¼</span>
</span></span><span style="display:flex;"><span>    STEP_PROMPTS <span style="color:#ff79c6">=</span> [
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;åˆ†æé—®é¢˜çš„å…³é”®ä¿¡æ¯å’Œçº¦æŸæ¡ä»¶&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;ç¡®å®šè§£å†³é—®é¢˜çš„æ–¹æ³•å’Œç­–ç•¥&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;æ‰§è¡Œå…·ä½“çš„è®¡ç®—æˆ–æ¨ç†è¿‡ç¨‹&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;éªŒè¯ç»“æœçš„åˆç†æ€§å’Œå®Œæ•´æ€§&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;æ€»ç»“å¹¶ç»™å‡ºæœ€ç»ˆç­”æ¡ˆ&#34;</span>
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">analyze_step</span>(state: CoTState) <span style="color:#ff79c6">-&gt;</span> CoTState:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        æ‰§è¡Œå•æ­¥æ¨ç†
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        æ¯æ¬¡è°ƒç”¨ç”Ÿæˆä¸€ä¸ªæ¨ç†æ­¥éª¤ï¼Œå¹¶å°†ç»“æœæ·»åŠ åˆ°æ¨ç†é“¾ä¸­
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        problem <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;problem&#34;</span>]
</span></span><span style="display:flex;"><span>        steps <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;steps&#34;</span>]
</span></span><span style="display:flex;"><span>        current <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;current_step&#34;</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># è·å–å½“å‰æ­¥éª¤çš„å¼•å¯¼æç¤º</span>
</span></span><span style="display:flex;"><span>        current_prompt <span style="color:#ff79c6">=</span> STEP_PROMPTS[current] <span style="color:#ff79c6">if</span> current <span style="color:#ff79c6">&lt;</span> <span style="color:#8be9fd;font-style:italic">len</span>(STEP_PROMPTS) <span style="color:#ff79c6">else</span> <span style="color:#f1fa8c">&#34;ç»§ç»­æ¨ç†&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># æ„å»ºåŒ…å«å†å²æ¨ç†çš„æç¤º</span>
</span></span><span style="display:flex;"><span>        prompt <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        é—®é¢˜: </span><span style="color:#f1fa8c">{</span>problem<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ä¹‹å‰çš„æ¨ç†æ­¥éª¤:
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        </span><span style="color:#f1fa8c">{</span><span style="color:#8be9fd;font-style:italic">chr</span>(<span style="color:#bd93f9">10</span>)<span style="color:#ff79c6">.</span>join([<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;æ­¥éª¤</span><span style="color:#f1fa8c">{</span>i<span style="color:#ff79c6">+</span><span style="color:#bd93f9">1</span><span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">: </span><span style="color:#f1fa8c">{</span>s<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span> <span style="color:#ff79c6">for</span> i, s <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">enumerate</span>(steps)])<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        å½“å‰ä»»åŠ¡: </span><span style="color:#f1fa8c">{</span>current_prompt<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        è¯·ç»™å‡ºè¿™ä¸€æ­¥çš„è¯¦ç»†æ¨ç†è¿‡ç¨‹ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        response <span style="color:#ff79c6">=</span> llm<span style="color:#ff79c6">.</span>invoke([HumanMessage(content<span style="color:#ff79c6">=</span>prompt)])
</span></span><span style="display:flex;"><span>        new_steps <span style="color:#ff79c6">=</span> steps <span style="color:#ff79c6">+</span> [response<span style="color:#ff79c6">.</span>content]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">**</span>state,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;steps&#34;</span>: new_steps,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;current_step&#34;</span>: current <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">finalize_answer</span>(state: CoTState) <span style="color:#ff79c6">-&gt;</span> CoTState:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ç»¼åˆæ‰€æœ‰æ¨ç†æ­¥éª¤ï¼Œç»™å‡ºç®€æ´æ˜ç¡®çš„æœ€ç»ˆç»“è®º
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        problem <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;problem&#34;</span>]
</span></span><span style="display:flex;"><span>        steps <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;steps&#34;</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        prompt <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        é—®é¢˜: </span><span style="color:#f1fa8c">{</span>problem<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        å®Œæ•´æ¨ç†è¿‡ç¨‹:
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        </span><span style="color:#f1fa8c">{</span><span style="color:#8be9fd;font-style:italic">chr</span>(<span style="color:#bd93f9">10</span>)<span style="color:#ff79c6">.</span>join([<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;æ­¥éª¤</span><span style="color:#f1fa8c">{</span>i<span style="color:#ff79c6">+</span><span style="color:#bd93f9">1</span><span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">: </span><span style="color:#f1fa8c">{</span>s<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span> <span style="color:#ff79c6">for</span> i, s <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">enumerate</span>(steps)])<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        è¯·åŸºäºä»¥ä¸Šæ¨ç†ï¼Œç»™å‡ºç®€æ´æ˜ç¡®çš„æœ€ç»ˆç­”æ¡ˆï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        response <span style="color:#ff79c6">=</span> llm<span style="color:#ff79c6">.</span>invoke([HumanMessage(content<span style="color:#ff79c6">=</span>prompt)])
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> {<span style="color:#ff79c6">**</span>state, <span style="color:#f1fa8c">&#34;final_answer&#34;</span>: response<span style="color:#ff79c6">.</span>content}
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">should_continue</span>(state: CoTState) <span style="color:#ff79c6">-&gt;</span> Literal[<span style="color:#f1fa8c">&#34;analyze&#34;</span>, <span style="color:#f1fa8c">&#34;finalize&#34;</span>]:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;è·¯ç”±å‡½æ•°ï¼šå†³å®šæ˜¯å¦ç»§ç»­æ¨ç†&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> state[<span style="color:#f1fa8c">&#34;current_step&#34;</span>] <span style="color:#ff79c6">&gt;=</span> max_steps:
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;finalize&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;analyze&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># ===== æ„å»ºçŠ¶æ€å›¾ =====</span>
</span></span><span style="display:flex;"><span>    workflow <span style="color:#ff79c6">=</span> StateGraph(CoTState)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># æ·»åŠ èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;analyze&#34;</span>, analyze_step)      <span style="color:#6272a4"># æ¨ç†èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;finalize&#34;</span>, finalize_answer)  <span style="color:#6272a4"># æ€»ç»“èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># è®¾ç½®å…¥å£ç‚¹</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>set_entry_point(<span style="color:#f1fa8c">&#34;analyze&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># æ·»åŠ æ¡ä»¶è¾¹ï¼šæ¨ç†å®Œæˆåå†³å®šç»§ç»­è¿˜æ˜¯æ€»ç»“</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_conditional_edges(
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;analyze&#34;</span>,
</span></span><span style="display:flex;"><span>        should_continue,
</span></span><span style="display:flex;"><span>        {<span style="color:#f1fa8c">&#34;analyze&#34;</span>: <span style="color:#f1fa8c">&#34;analyze&#34;</span>, <span style="color:#f1fa8c">&#34;finalize&#34;</span>: <span style="color:#f1fa8c">&#34;finalize&#34;</span>}
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_edge(<span style="color:#f1fa8c">&#34;finalize&#34;</span>, END)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> workflow<span style="color:#ff79c6">.</span>compile()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># ä½¿ç”¨ç¤ºä¾‹</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">solve_with_cot</span>(problem: <span style="color:#8be9fd;font-style:italic">str</span>):
</span></span><span style="display:flex;"><span>    agent <span style="color:#ff79c6">=</span> create_cot_agent(max_steps<span style="color:#ff79c6">=</span><span style="color:#bd93f9">4</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    result <span style="color:#ff79c6">=</span> agent<span style="color:#ff79c6">.</span>invoke({
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;problem&#34;</span>: problem,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;steps&#34;</span>: [],
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;current_step&#34;</span>: <span style="color:#bd93f9">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;final_answer&#34;</span>: <span style="color:#f1fa8c">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># è¾“å‡ºå®Œæ•´æ¨ç†é“¾</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">for</span> i, step <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">enumerate</span>(result[<span style="color:#f1fa8c">&#34;steps&#34;</span>]):
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;æ­¥éª¤</span><span style="color:#f1fa8c">{</span>i<span style="color:#ff79c6">+</span><span style="color:#bd93f9">1</span><span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">: </span><span style="color:#f1fa8c">{</span>step<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">æœ€ç»ˆç­”æ¡ˆ: </span><span style="color:#f1fa8c">{</span>result[<span style="color:#f1fa8c">&#39;final_answer&#39;</span>]<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> result[<span style="color:#f1fa8c">&#34;final_answer&#34;</span>]
</span></span></code></pre></div><hr>
<h3 id="multi-agent-åä½œæ¨¡å¼">Multi-Agent åä½œæ¨¡å¼</h3>
<h4 id="åä½œæ¶æ„">åä½œæ¶æ„</h4>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">graph TB
    subgraph &#34;Multi-Agent åä½œç³»ç»Ÿ&#34;
        C[Coordinator åè°ƒè€…]
        
        subgraph &#34;ä¸“ä¸šæ™ºèƒ½ä½“&#34;
            A1[Research Agent&lt;br/&gt;ç ”ç©¶ä¸“å®¶]
            A2[Analysis Agent&lt;br/&gt;åˆ†æä¸“å®¶]
            A3[Writing Agent&lt;br/&gt;å†™ä½œä¸“å®¶]
            A4[Review Agent&lt;br/&gt;å®¡æ ¸ä¸“å®¶]
        end
        
        subgraph &#34;å…±äº«èµ„æº&#34;
            KB[(Knowledge Base)]
            WS[(Workspace)]
            CM[(Communication)]
        end
    end
    
    User[ç”¨æˆ·] --&gt; C
    C --&gt; A1
    C --&gt; A2
    C --&gt; A3
    C --&gt; A4
    
    A1 &lt;--&gt; KB
    A2 &lt;--&gt; KB
    A3 &lt;--&gt; WS
    A4 &lt;--&gt; WS
    
    A1 &lt;--&gt; CM
    A2 &lt;--&gt; CM
    A3 &lt;--&gt; CM
    A4 &lt;--&gt; CM
    
    C --&gt; User
</code></pre><h4 id="åä½œæµç¨‹">åä½œæµç¨‹</h4>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">sequenceDiagram
    participant U as ç”¨æˆ·
    participant C as åè°ƒè€…
    participant R as ç ”ç©¶æ™ºèƒ½ä½“
    participant A as åˆ†ææ™ºèƒ½ä½“
    participant W as å†™ä½œæ™ºèƒ½ä½“
    participant V as å®¡æ ¸æ™ºèƒ½ä½“
    
    U-&gt;&gt;C: æäº¤ä»»åŠ¡
    C-&gt;&gt;C: ä»»åŠ¡åˆ†è§£
    
    par å¹¶è¡Œæ‰§è¡Œ
        C-&gt;&gt;R: åˆ†é…ç ”ç©¶ä»»åŠ¡
        C-&gt;&gt;A: åˆ†é…åˆ†æä»»åŠ¡
    end
    
    R-&gt;&gt;C: ç ”ç©¶ç»“æœ
    A-&gt;&gt;C: åˆ†æç»“æœ
    
    C-&gt;&gt;W: æ•´åˆä¿¡æ¯ï¼Œå¼€å§‹å†™ä½œ
    W-&gt;&gt;C: åˆç¨¿å®Œæˆ
    
    C-&gt;&gt;V: æäº¤å®¡æ ¸
    V-&gt;&gt;C: å®¡æ ¸æ„è§
    
    alt éœ€è¦ä¿®æ”¹
        C-&gt;&gt;W: ä¿®æ”¹å»ºè®®
        W-&gt;&gt;C: ä¿®æ”¹ç‰ˆæœ¬
    else é€šè¿‡å®¡æ ¸
        C-&gt;&gt;U: æœ€ç»ˆç»“æœ
    end
</code></pre><h4 id="å®ç°ç¤ºä¾‹langgraph-2">å®ç°ç¤ºä¾‹ï¼ˆLangGraphï¼‰</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">from</span> typing <span style="color:#ff79c6">import</span> TypedDict, Literal, Optional
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langgraph.graph <span style="color:#ff79c6">import</span> StateGraph, END
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langchain_openai <span style="color:#ff79c6">import</span> ChatOpenAI
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langchain_core.messages <span style="color:#ff79c6">import</span> HumanMessage
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># å®šä¹‰çŠ¶æ€ç±»å‹</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">MultiAgentState</span>(TypedDict):
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;&#34;&#34;Multi-Agentåä½œç³»ç»ŸçŠ¶æ€å®šä¹‰&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    task: <span style="color:#8be9fd;font-style:italic">str</span>                         <span style="color:#6272a4"># åŸå§‹ä»»åŠ¡</span>
</span></span><span style="display:flex;"><span>    research_result: Optional[<span style="color:#8be9fd;font-style:italic">str</span>]    <span style="color:#6272a4"># ç ”ç©¶æ™ºèƒ½ä½“è¾“å‡º</span>
</span></span><span style="display:flex;"><span>    analysis_result: Optional[<span style="color:#8be9fd;font-style:italic">str</span>]    <span style="color:#6272a4"># åˆ†ææ™ºèƒ½ä½“è¾“å‡º</span>
</span></span><span style="display:flex;"><span>    draft: Optional[<span style="color:#8be9fd;font-style:italic">str</span>]              <span style="color:#6272a4"># å†™ä½œæ™ºèƒ½ä½“è¾“å‡ºï¼ˆè‰ç¨¿ï¼‰</span>
</span></span><span style="display:flex;"><span>    review_result: Optional[<span style="color:#8be9fd;font-style:italic">dict</span>]     <span style="color:#6272a4"># å®¡æ ¸æ™ºèƒ½ä½“è¾“å‡º</span>
</span></span><span style="display:flex;"><span>    final_result: Optional[<span style="color:#8be9fd;font-style:italic">str</span>]       <span style="color:#6272a4"># æœ€ç»ˆç»“æœ</span>
</span></span><span style="display:flex;"><span>    revision_count: <span style="color:#8be9fd;font-style:italic">int</span>               <span style="color:#6272a4"># ä¿®æ”¹æ¬¡æ•°</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">create_multi_agent_system</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    åˆ›å»ºMulti-Agentåä½œç³»ç»Ÿ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    ç³»ç»ŸåŒ…å«å››ä¸ªä¸“ä¸šæ™ºèƒ½ä½“ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    - Research Agent: è´Ÿè´£æ”¶é›†å’Œæ•´ç†ç›¸å…³ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    - Analysis Agent: è´Ÿè´£æ·±åº¦åˆ†æç ”ç©¶ç»“æœ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    - Writing Agent: è´Ÿè´£æ’°å†™å†…å®¹
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    - Review Agent: è´Ÿè´£å®¡æ ¸å¹¶æä¾›åé¦ˆ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    Returns:
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ç¼–è¯‘åçš„LangGraphå·¥ä½œæµ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># å„ä¸“ä¸šæ™ºèƒ½ä½“ä½¿ç”¨ä¸åŒçš„é…ç½®</span>
</span></span><span style="display:flex;"><span>    research_llm <span style="color:#ff79c6">=</span> ChatOpenAI(model<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;gpt-4&#34;</span>, temperature<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0.7</span>)   <span style="color:#6272a4"># è¾ƒé«˜åˆ›é€ æ€§</span>
</span></span><span style="display:flex;"><span>    analysis_llm <span style="color:#ff79c6">=</span> ChatOpenAI(model<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;gpt-4&#34;</span>, temperature<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0</span>)     <span style="color:#6272a4"># ç²¾ç¡®åˆ†æ</span>
</span></span><span style="display:flex;"><span>    writing_llm <span style="color:#ff79c6">=</span> ChatOpenAI(model<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;gpt-4&#34;</span>, temperature<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0.5</span>)    <span style="color:#6272a4"># å¹³è¡¡åˆ›é€ æ€§</span>
</span></span><span style="display:flex;"><span>    review_llm <span style="color:#ff79c6">=</span> ChatOpenAI(model<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;gpt-4&#34;</span>, temperature<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0</span>)       <span style="color:#6272a4"># ä¸¥æ ¼å®¡æ ¸</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">coordinator_node</span>(state: MultiAgentState) <span style="color:#ff79c6">-&gt;</span> MultiAgentState:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        åè°ƒè€…èŠ‚ç‚¹ï¼šåˆå§‹åŒ–ä»»åŠ¡åˆ†é…
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        åœ¨å®é™…åœºæ™¯ä¸­å¯ä»¥è¿›è¡Œä»»åŠ¡åˆ†è§£å’Œæ™ºèƒ½ä½“é€‰æ‹©
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> state
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">research_agent</span>(state: MultiAgentState) <span style="color:#ff79c6">-&gt;</span> MultiAgentState:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ç ”ç©¶æ™ºèƒ½ä½“ï¼šæ”¶é›†å’Œæ•´ç†ç›¸å…³ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        èŒè´£ï¼šèƒŒæ™¯è°ƒç ”ã€èµ„æ–™æ”¶é›†ã€å…³é”®ä¿¡æ¯æå–
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        task <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;task&#34;</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        prompt <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç ”ç©¶å‘˜ã€‚è¯·é’ˆå¯¹ä»¥ä¸‹ä»»åŠ¡è¿›è¡Œæ·±å…¥ç ”ç©¶ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ä»»åŠ¡ï¼š</span><span style="color:#f1fa8c">{</span>task<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        è¯·æä¾›ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        1. ç›¸å…³èƒŒæ™¯ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        2. å…³é”®æ¦‚å¿µè§£é‡Š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        3. é‡è¦æ•°æ®å’Œäº‹å®
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        4. å‚è€ƒèµ„æºåˆ—è¡¨
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        response <span style="color:#ff79c6">=</span> research_llm<span style="color:#ff79c6">.</span>invoke([HumanMessage(content<span style="color:#ff79c6">=</span>prompt)])
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> {<span style="color:#ff79c6">**</span>state, <span style="color:#f1fa8c">&#34;research_result&#34;</span>: response<span style="color:#ff79c6">.</span>content}
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">analysis_agent</span>(state: MultiAgentState) <span style="color:#ff79c6">-&gt;</span> MultiAgentState:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        åˆ†ææ™ºèƒ½ä½“ï¼šæ·±åº¦åˆ†æç ”ç©¶ç»“æœ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        èŒè´£ï¼šé€»è¾‘åˆ†æã€è§‚ç‚¹æç‚¼ã€ä¼˜åŠ£åŠ¿è¯„ä¼°
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        task <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;task&#34;</span>]
</span></span><span style="display:flex;"><span>        research <span style="color:#ff79c6">=</span> state<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">&#34;research_result&#34;</span>, <span style="color:#f1fa8c">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        prompt <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„åˆ†æå¸ˆã€‚è¯·åŸºäºä»¥ä¸‹ä¿¡æ¯è¿›è¡Œæ·±åº¦åˆ†æï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ä»»åŠ¡ï¼š</span><span style="color:#f1fa8c">{</span>task<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ç ”ç©¶èµ„æ–™ï¼š</span><span style="color:#f1fa8c">{</span>research<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        è¯·æä¾›ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        1. æ ¸å¿ƒè§‚ç‚¹æ€»ç»“
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        2. é€»è¾‘å…³ç³»åˆ†æ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        3. ä¼˜åŠ£åŠ¿è¯„ä¼°
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        4. å»ºè®®å’Œç»“è®º
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        response <span style="color:#ff79c6">=</span> analysis_llm<span style="color:#ff79c6">.</span>invoke([HumanMessage(content<span style="color:#ff79c6">=</span>prompt)])
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> {<span style="color:#ff79c6">**</span>state, <span style="color:#f1fa8c">&#34;analysis_result&#34;</span>: response<span style="color:#ff79c6">.</span>content}
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">writing_agent</span>(state: MultiAgentState) <span style="color:#ff79c6">-&gt;</span> MultiAgentState:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        å†™ä½œæ™ºèƒ½ä½“ï¼šæ’°å†™å†…å®¹
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        èŒè´£ï¼šæ•´åˆä¿¡æ¯ã€æ’°å†™æ–‡ç« ã€å“åº”ä¿®æ”¹æ„è§
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        task <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;task&#34;</span>]
</span></span><span style="display:flex;"><span>        research <span style="color:#ff79c6">=</span> state<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">&#34;research_result&#34;</span>, <span style="color:#f1fa8c">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>        analysis <span style="color:#ff79c6">=</span> state<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">&#34;analysis_result&#34;</span>, <span style="color:#f1fa8c">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>        review <span style="color:#ff79c6">=</span> state<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">&#34;review_result&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> review <span style="color:#ff79c6">and</span> <span style="color:#ff79c6">not</span> review<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">&#34;approved&#34;</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4"># æ ¹æ®å®¡æ ¸æ„è§è¿›è¡Œä¿®æ”¹</span>
</span></span><span style="display:flex;"><span>            prompt <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            è¯·æ ¹æ®ä»¥ä¸‹å®¡æ ¸æ„è§ä¿®æ”¹æ–‡ç« ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            åŸæ–‡ï¼š</span><span style="color:#f1fa8c">{</span>state<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">&#39;draft&#39;</span>, <span style="color:#f1fa8c">&#39;&#39;</span>)<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            å®¡æ ¸æ„è§ï¼š</span><span style="color:#f1fa8c">{</span>review<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">&#39;feedback&#39;</span>, <span style="color:#f1fa8c">&#39;&#39;</span>)<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            è¯·è¾“å‡ºä¿®æ”¹åçš„å®Œæ•´æ–‡ç« ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4"># é¦–æ¬¡æ’°å†™</span>
</span></span><span style="display:flex;"><span>            prompt <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å†™ä½œè€…ã€‚è¯·åŸºäºä»¥ä¸‹ææ–™æ’°å†™é«˜è´¨é‡å†…å®¹ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            ä»»åŠ¡ï¼š</span><span style="color:#f1fa8c">{</span>task<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            ç ”ç©¶èµ„æ–™ï¼š</span><span style="color:#f1fa8c">{</span>research<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            åˆ†æç»“æœï¼š</span><span style="color:#f1fa8c">{</span>analysis<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            è¯·æ’°å†™ä¸€ç¯‡ç»“æ„æ¸…æ™°ã€å†…å®¹ä¸°å¯Œçš„æ–‡ç« ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        response <span style="color:#ff79c6">=</span> writing_llm<span style="color:#ff79c6">.</span>invoke([HumanMessage(content<span style="color:#ff79c6">=</span>prompt)])
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> {<span style="color:#ff79c6">**</span>state, <span style="color:#f1fa8c">&#34;draft&#34;</span>: response<span style="color:#ff79c6">.</span>content}
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">review_agent</span>(state: MultiAgentState) <span style="color:#ff79c6">-&gt;</span> MultiAgentState:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        å®¡æ ¸æ™ºèƒ½ä½“ï¼šå®¡æ ¸å¹¶æä¾›åé¦ˆ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        èŒè´£ï¼šè´¨é‡è¯„ä¼°ã€é—®é¢˜è¯†åˆ«ã€æ”¹è¿›å»ºè®®
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        task <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;task&#34;</span>]
</span></span><span style="display:flex;"><span>        draft <span style="color:#ff79c6">=</span> state<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">&#34;draft&#34;</span>, <span style="color:#f1fa8c">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        prompt <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ä½ æ˜¯ä¸€ä¸ªä¸¥æ ¼çš„å®¡æ ¸ä¸“å®¶ã€‚è¯·å®¡æ ¸ä»¥ä¸‹å†…å®¹ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        åŸå§‹ä»»åŠ¡ï¼š</span><span style="color:#f1fa8c">{</span>task<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        å¾…å®¡æ ¸å†…å®¹ï¼š</span><span style="color:#f1fa8c">{</span>draft<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        è¯·ä»¥JSONæ ¼å¼è¾“å‡ºå®¡æ ¸ç»“æœï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        </span><span style="color:#f1fa8c">{{</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;approved&#34;: true,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;score&#34;: 8,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;feedback&#34;: &#34;å…·ä½“çš„ä¿®æ”¹å»ºè®®æˆ–é€šè¿‡ç†ç”±&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        </span><span style="color:#f1fa8c">}}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        response <span style="color:#ff79c6">=</span> review_llm<span style="color:#ff79c6">.</span>invoke([HumanMessage(content<span style="color:#ff79c6">=</span>prompt)])
</span></span><span style="display:flex;"><span>        review_result <span style="color:#ff79c6">=</span> json<span style="color:#ff79c6">.</span>loads(response<span style="color:#ff79c6">.</span>content)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">**</span>state,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;review_result&#34;</span>: review_result,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;revision_count&#34;</span>: state[<span style="color:#f1fa8c">&#34;revision_count&#34;</span>] <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">finalize_node</span>(state: MultiAgentState) <span style="color:#ff79c6">-&gt;</span> MultiAgentState:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;æœ€ç»ˆç¡®è®¤è¾“å‡º&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> {<span style="color:#ff79c6">**</span>state, <span style="color:#f1fa8c">&#34;final_result&#34;</span>: state<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">&#34;draft&#34;</span>, <span style="color:#f1fa8c">&#34;&#34;</span>)}
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">should_revise</span>(state: MultiAgentState) <span style="color:#ff79c6">-&gt;</span> Literal[<span style="color:#f1fa8c">&#34;writing&#34;</span>, <span style="color:#f1fa8c">&#34;finalize&#34;</span>]:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        è·¯ç”±å‡½æ•°ï¼šå†³å®šæ˜¯å¦éœ€è¦ä¿®æ”¹
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        Returns:
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;writing&#34;: éœ€è¦ä¿®æ”¹
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;finalize&#34;: å®¡æ ¸é€šè¿‡æˆ–è¾¾åˆ°æœ€å¤§ä¿®æ”¹æ¬¡æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        review <span style="color:#ff79c6">=</span> state<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">&#34;review_result&#34;</span>, {})
</span></span><span style="display:flex;"><span>        revision_count <span style="color:#ff79c6">=</span> state<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">&#34;revision_count&#34;</span>, <span style="color:#bd93f9">0</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># é˜²æ­¢æ— é™ä¿®æ”¹å¾ªç¯</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> revision_count <span style="color:#ff79c6">&gt;=</span> <span style="color:#bd93f9">3</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;finalize&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> review<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">&#34;approved&#34;</span>, <span style="color:#ff79c6">False</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;finalize&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;writing&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># ===== æ„å»ºçŠ¶æ€å›¾ =====</span>
</span></span><span style="display:flex;"><span>    workflow <span style="color:#ff79c6">=</span> StateGraph(MultiAgentState)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># æ·»åŠ æ™ºèƒ½ä½“èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;coordinator&#34;</span>, coordinator_node)  <span style="color:#6272a4"># åè°ƒè€…</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;research&#34;</span>, research_agent)       <span style="color:#6272a4"># ç ”ç©¶æ™ºèƒ½ä½“</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;analysis&#34;</span>, analysis_agent)       <span style="color:#6272a4"># åˆ†ææ™ºèƒ½ä½“</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;writing&#34;</span>, writing_agent)         <span style="color:#6272a4"># å†™ä½œæ™ºèƒ½ä½“</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;review&#34;</span>, review_agent)           <span style="color:#6272a4"># å®¡æ ¸æ™ºèƒ½ä½“</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;finalize&#34;</span>, finalize_node)        <span style="color:#6272a4"># æœ€ç»ˆè¾“å‡º</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># è®¾ç½®å…¥å£ç‚¹</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>set_entry_point(<span style="color:#f1fa8c">&#34;coordinator&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># å®šä¹‰åä½œæµç¨‹ï¼ˆä¸²è¡Œå±•ç¤ºï¼Œå®é™…å¯å¹¶è¡Œä¼˜åŒ–ï¼‰</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_edge(<span style="color:#f1fa8c">&#34;coordinator&#34;</span>, <span style="color:#f1fa8c">&#34;research&#34;</span>)
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_edge(<span style="color:#f1fa8c">&#34;research&#34;</span>, <span style="color:#f1fa8c">&#34;analysis&#34;</span>)
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_edge(<span style="color:#f1fa8c">&#34;analysis&#34;</span>, <span style="color:#f1fa8c">&#34;writing&#34;</span>)
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_edge(<span style="color:#f1fa8c">&#34;writing&#34;</span>, <span style="color:#f1fa8c">&#34;review&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># å®¡æ ¸åå†³å®šæ˜¯ä¿®æ”¹è¿˜æ˜¯å®Œæˆ</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_conditional_edges(
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;review&#34;</span>,
</span></span><span style="display:flex;"><span>        should_revise,
</span></span><span style="display:flex;"><span>        {<span style="color:#f1fa8c">&#34;writing&#34;</span>: <span style="color:#f1fa8c">&#34;writing&#34;</span>, <span style="color:#f1fa8c">&#34;finalize&#34;</span>: <span style="color:#f1fa8c">&#34;finalize&#34;</span>}
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_edge(<span style="color:#f1fa8c">&#34;finalize&#34;</span>, END)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> workflow<span style="color:#ff79c6">.</span>compile()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># ä½¿ç”¨ç¤ºä¾‹</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">run_multi_agent</span>(task: <span style="color:#8be9fd;font-style:italic">str</span>):
</span></span><span style="display:flex;"><span>    system <span style="color:#ff79c6">=</span> create_multi_agent_system()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    result <span style="color:#ff79c6">=</span> system<span style="color:#ff79c6">.</span>invoke({
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;task&#34;</span>: task,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;research_result&#34;</span>: <span style="color:#ff79c6">None</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;analysis_result&#34;</span>: <span style="color:#ff79c6">None</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;draft&#34;</span>: <span style="color:#ff79c6">None</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;review_result&#34;</span>: <span style="color:#ff79c6">None</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;final_result&#34;</span>: <span style="color:#ff79c6">None</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;revision_count&#34;</span>: <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> result[<span style="color:#f1fa8c">&#34;final_result&#34;</span>]
</span></span></code></pre></div><hr>
<h3 id="hierarchical-agent-æ¨¡å¼">Hierarchical Agent æ¨¡å¼</h3>
<h4 id="å±‚æ¬¡ç»“æ„">å±‚æ¬¡ç»“æ„</h4>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">graph TD
    subgraph &#34;Hierarchical Agent æ¶æ„&#34;
        M[Master Agent&lt;br/&gt;ä¸»æ§æ™ºèƒ½ä½“]
        
        subgraph &#34;ä¸­å±‚ç®¡ç†&#34;
            S1[Supervisor 1&lt;br/&gt;ä»»åŠ¡ç®¡ç†]
            S2[Supervisor 2&lt;br/&gt;èµ„æºç®¡ç†]
            S3[Supervisor 3&lt;br/&gt;è´¨é‡ç®¡ç†]
        end
        
        subgraph &#34;æ‰§è¡Œå±‚&#34;
            W1[Worker 1]
            W2[Worker 2]
            W3[Worker 3]
            W4[Worker 4]
            W5[Worker 5]
            W6[Worker 6]
        end
    end
    
    M --&gt; S1
    M --&gt; S2
    M --&gt; S3
    
    S1 --&gt; W1
    S1 --&gt; W2
    S2 --&gt; W3
    S2 --&gt; W4
    S3 --&gt; W5
    S3 --&gt; W6
    
    style M fill:#ff9999
    style S1 fill:#99ccff
    style S2 fill:#99ccff
    style S3 fill:#99ccff
    style W1 fill:#99ff99
    style W2 fill:#99ff99
    style W3 fill:#99ff99
    style W4 fill:#99ff99
    style W5 fill:#99ff99
    style W6 fill:#99ff99
</code></pre><h4 id="å®ç°ç¤ºä¾‹langgraph-3">å®ç°ç¤ºä¾‹ï¼ˆLangGraphï¼‰</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">from</span> typing <span style="color:#ff79c6">import</span> TypedDict, List, Optional, Dict
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langgraph.graph <span style="color:#ff79c6">import</span> StateGraph, END
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langchain_openai <span style="color:#ff79c6">import</span> ChatOpenAI
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langchain_core.messages <span style="color:#ff79c6">import</span> HumanMessage
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># å®šä¹‰çŠ¶æ€ç±»å‹</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">HierarchicalState</span>(TypedDict):
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;&#34;&#34;Hierarchical Agentå±‚æ¬¡åŒ–æ™ºèƒ½ä½“çŠ¶æ€å®šä¹‰&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    task: <span style="color:#8be9fd;font-style:italic">str</span>                              <span style="color:#6272a4"># åŸå§‹ä»»åŠ¡</span>
</span></span><span style="display:flex;"><span>    subtasks: Dict[<span style="color:#8be9fd;font-style:italic">str</span>, List[<span style="color:#8be9fd;font-style:italic">str</span>]]         <span style="color:#6272a4"># supervisor_name -&gt; [å­ä»»åŠ¡åˆ—è¡¨]</span>
</span></span><span style="display:flex;"><span>    worker_results: Dict[<span style="color:#8be9fd;font-style:italic">str</span>, <span style="color:#8be9fd;font-style:italic">str</span>]         <span style="color:#6272a4"># worker_id -&gt; æ‰§è¡Œç»“æœ</span>
</span></span><span style="display:flex;"><span>    supervisor_summaries: Dict[<span style="color:#8be9fd;font-style:italic">str</span>, <span style="color:#8be9fd;font-style:italic">str</span>]   <span style="color:#6272a4"># supervisor_name -&gt; æ±‡æ€»æŠ¥å‘Š</span>
</span></span><span style="display:flex;"><span>    final_result: Optional[<span style="color:#8be9fd;font-style:italic">str</span>]            <span style="color:#6272a4"># æœ€ç»ˆç»“æœ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">create_hierarchical_agent</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    åˆ›å»ºHierarchical Agentå±‚æ¬¡åŒ–æ™ºèƒ½ä½“ç³»ç»Ÿ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    ä¸‰å±‚æ¶æ„ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    - Master Agent (ä¸»æ§å±‚): ä»»åŠ¡åˆ†è§£å’Œæœ€ç»ˆæ±‡æ€»
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    - Supervisor Agents (ç®¡ç†å±‚): ç®¡ç†å„è‡ªé¢†åŸŸçš„Worker
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    - Worker Agents (æ‰§è¡Œå±‚): å…·ä½“ä»»åŠ¡æ‰§è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    Returns:
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ç¼–è¯‘åçš„LangGraphå·¥ä½œæµ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># ä¸åŒå±‚çº§ä½¿ç”¨ä¸åŒçš„æ¨¡å‹é…ç½®</span>
</span></span><span style="display:flex;"><span>    master_llm <span style="color:#ff79c6">=</span> ChatOpenAI(model<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;gpt-4&#34;</span>, temperature<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0</span>)        <span style="color:#6272a4"># ä¸»æ§ï¼šç²¾ç¡®å†³ç­–</span>
</span></span><span style="display:flex;"><span>    supervisor_llm <span style="color:#ff79c6">=</span> ChatOpenAI(model<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;gpt-4&#34;</span>, temperature<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0</span>)    <span style="color:#6272a4"># ç®¡ç†ï¼šæ±‡æ€»åˆ†æ</span>
</span></span><span style="display:flex;"><span>    worker_llm <span style="color:#ff79c6">=</span> ChatOpenAI(model<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;gpt-3.5-turbo&#34;</span>, temperature<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0.5</span>)  <span style="color:#6272a4"># æ‰§è¡Œï¼šé«˜æ•ˆå®Œæˆ</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">master_node</span>(state: HierarchicalState) <span style="color:#ff79c6">-&gt;</span> HierarchicalState:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ä¸»æ§æ™ºèƒ½ä½“ï¼šä»»åŠ¡åˆ†è§£
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        å°†å¤æ‚ä»»åŠ¡åˆ†è§£ç»™ä¸‰ä¸ªç®¡ç†è€…ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        - task_supervisor: ä»»åŠ¡æ‰§è¡Œç®¡ç†
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        - resource_supervisor: èµ„æºç®¡ç†
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        - quality_supervisor: è´¨é‡ä¿è¯
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        task <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;task&#34;</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        prompt <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ä½ æ˜¯ä¸»æ§æ™ºèƒ½ä½“ã€‚è¯·å°†ä»¥ä¸‹ä»»åŠ¡åˆ†è§£ç»™ä¸‰ä¸ªç®¡ç†è€…ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        - task_supervisor: è´Ÿè´£ä»»åŠ¡æ‰§è¡Œç›¸å…³çš„å­ä»»åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        - resource_supervisor: è´Ÿè´£èµ„æºç®¡ç†ç›¸å…³çš„å­ä»»åŠ¡  
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        - quality_supervisor: è´Ÿè´£è´¨é‡ä¿è¯ç›¸å…³çš„å­ä»»åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ä»»åŠ¡ï¼š</span><span style="color:#f1fa8c">{</span>task<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        è¯·ä»¥JSONæ ¼å¼è¾“å‡ºä»»åŠ¡åˆ†é…ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        </span><span style="color:#f1fa8c">{{</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;task_supervisor&#34;: [&#34;å­ä»»åŠ¡1&#34;, &#34;å­ä»»åŠ¡2&#34;],
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;resource_supervisor&#34;: [&#34;å­ä»»åŠ¡1&#34;, &#34;å­ä»»åŠ¡2&#34;],
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;quality_supervisor&#34;: [&#34;å­ä»»åŠ¡1&#34;, &#34;å­ä»»åŠ¡2&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        </span><span style="color:#f1fa8c">}}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        response <span style="color:#ff79c6">=</span> master_llm<span style="color:#ff79c6">.</span>invoke([HumanMessage(content<span style="color:#ff79c6">=</span>prompt)])
</span></span><span style="display:flex;"><span>        subtasks <span style="color:#ff79c6">=</span> json<span style="color:#ff79c6">.</span>loads(response<span style="color:#ff79c6">.</span>content)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> {<span style="color:#ff79c6">**</span>state, <span style="color:#f1fa8c">&#34;subtasks&#34;</span>: subtasks}
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">create_supervisor_node</span>(supervisor_name: <span style="color:#8be9fd;font-style:italic">str</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        åˆ›å»ºSupervisorèŠ‚ç‚¹çš„å·¥å‚å‡½æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        æ¯ä¸ªSupervisorè´Ÿè´£ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        1. åˆ†å‘å­ä»»åŠ¡ç»™Worker
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        2. æ”¶é›†Workeræ‰§è¡Œç»“æœ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        3. æ±‡æ€»å¹¶ç”ŸæˆæŠ¥å‘Š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        Args:
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            supervisor_name: ç®¡ç†è€…åç§°
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        Returns:
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            supervisorèŠ‚ç‚¹å‡½æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">supervisor_node</span>(state: HierarchicalState) <span style="color:#ff79c6">-&gt;</span> HierarchicalState:
</span></span><span style="display:flex;"><span>            subtasks <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;subtasks&#34;</span>]<span style="color:#ff79c6">.</span>get(supervisor_name, [])
</span></span><span style="display:flex;"><span>            worker_results <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;worker_results&#34;</span>]<span style="color:#ff79c6">.</span>copy()
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4"># Workerå±‚ï¼šæ‰§è¡Œå„å­ä»»åŠ¡</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">for</span> i, subtask <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">enumerate</span>(subtasks):
</span></span><span style="display:flex;"><span>                worker_prompt <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">                ä½ æ˜¯ä¸€ä¸ªæ‰§è¡Œè€…ã€‚è¯·å®Œæˆä»¥ä¸‹å­ä»»åŠ¡ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">                </span><span style="color:#f1fa8c">{</span>subtask<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">                
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">                è¯·ç›´æ¥è¾“å‡ºæ‰§è¡Œç»“æœã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">                &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>                response <span style="color:#ff79c6">=</span> worker_llm<span style="color:#ff79c6">.</span>invoke([HumanMessage(content<span style="color:#ff79c6">=</span>worker_prompt)])
</span></span><span style="display:flex;"><span>                worker_results[<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">{</span>supervisor_name<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">_worker_</span><span style="color:#f1fa8c">{</span>i<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span>] <span style="color:#ff79c6">=</span> response<span style="color:#ff79c6">.</span>content
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4"># Supervisorå±‚ï¼šæ±‡æ€»Workerç»“æœ</span>
</span></span><span style="display:flex;"><span>            relevant_results <span style="color:#ff79c6">=</span> {k: v <span style="color:#ff79c6">for</span> k, v <span style="color:#ff79c6">in</span> worker_results<span style="color:#ff79c6">.</span>items() 
</span></span><span style="display:flex;"><span>                               <span style="color:#ff79c6">if</span> k<span style="color:#ff79c6">.</span>startswith(supervisor_name)}
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            summary_prompt <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            ä½ æ˜¯</span><span style="color:#f1fa8c">{</span>supervisor_name<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">ç®¡ç†è€…ã€‚è¯·æ±‡æ€»ä»¥ä¸‹Workerçš„æ‰§è¡Œç»“æœï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            </span><span style="color:#f1fa8c">{</span>json<span style="color:#ff79c6">.</span>dumps(relevant_results, ensure_ascii<span style="color:#ff79c6">=</span><span style="color:#ff79c6">False</span>)<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            è¯·è¾“å‡ºæ±‡æ€»æŠ¥å‘Šã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            summary <span style="color:#ff79c6">=</span> supervisor_llm<span style="color:#ff79c6">.</span>invoke([HumanMessage(content<span style="color:#ff79c6">=</span>summary_prompt)])
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            supervisor_summaries <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;supervisor_summaries&#34;</span>]<span style="color:#ff79c6">.</span>copy()
</span></span><span style="display:flex;"><span>            supervisor_summaries[supervisor_name] <span style="color:#ff79c6">=</span> summary<span style="color:#ff79c6">.</span>content
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">**</span>state,
</span></span><span style="display:flex;"><span>                <span style="color:#f1fa8c">&#34;worker_results&#34;</span>: worker_results,
</span></span><span style="display:flex;"><span>                <span style="color:#f1fa8c">&#34;supervisor_summaries&#34;</span>: supervisor_summaries
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> supervisor_node
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">aggregation_node</span>(state: HierarchicalState) <span style="color:#ff79c6">-&gt;</span> HierarchicalState:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        èšåˆèŠ‚ç‚¹ï¼šç»¼åˆæ‰€æœ‰Supervisorçš„ç»“æœ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        Master Agentæ±‡æ€»å„ç®¡ç†è€…çš„æŠ¥å‘Šï¼Œç”Ÿæˆæœ€ç»ˆç»“æœ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        task <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;task&#34;</span>]
</span></span><span style="display:flex;"><span>        summaries <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;supervisor_summaries&#34;</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        prompt <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ä½ æ˜¯ä¸»æ§æ™ºèƒ½ä½“ã€‚è¯·ç»¼åˆä»¥ä¸‹å„ç®¡ç†è€…çš„æ±‡æŠ¥ï¼Œç”Ÿæˆæœ€ç»ˆç»“æœï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        åŸå§‹ä»»åŠ¡ï¼š</span><span style="color:#f1fa8c">{</span>task<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ä»»åŠ¡ç®¡ç†æŠ¥å‘Šï¼š</span><span style="color:#f1fa8c">{</span>summaries<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">&#39;task_supervisor&#39;</span>, <span style="color:#f1fa8c">&#39;&#39;</span>)<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        èµ„æºç®¡ç†æŠ¥å‘Šï¼š</span><span style="color:#f1fa8c">{</span>summaries<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">&#39;resource_supervisor&#39;</span>, <span style="color:#f1fa8c">&#39;&#39;</span>)<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        è´¨é‡ç®¡ç†æŠ¥å‘Šï¼š</span><span style="color:#f1fa8c">{</span>summaries<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">&#39;quality_supervisor&#39;</span>, <span style="color:#f1fa8c">&#39;&#39;</span>)<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        è¯·è¾“å‡ºæœ€ç»ˆçš„ç»¼åˆæŠ¥å‘Šã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        response <span style="color:#ff79c6">=</span> master_llm<span style="color:#ff79c6">.</span>invoke([HumanMessage(content<span style="color:#ff79c6">=</span>prompt)])
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> {<span style="color:#ff79c6">**</span>state, <span style="color:#f1fa8c">&#34;final_result&#34;</span>: response<span style="color:#ff79c6">.</span>content}
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># ===== æ„å»ºçŠ¶æ€å›¾ =====</span>
</span></span><span style="display:flex;"><span>    workflow <span style="color:#ff79c6">=</span> StateGraph(HierarchicalState)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># æ·»åŠ èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;master&#34;</span>, master_node)  <span style="color:#6272a4"># ä¸»æ§å±‚</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;task_supervisor&#34;</span>, create_supervisor_node(<span style="color:#f1fa8c">&#34;task_supervisor&#34;</span>))
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;resource_supervisor&#34;</span>, create_supervisor_node(<span style="color:#f1fa8c">&#34;resource_supervisor&#34;</span>))
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;quality_supervisor&#34;</span>, create_supervisor_node(<span style="color:#f1fa8c">&#34;quality_supervisor&#34;</span>))
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;aggregation&#34;</span>, aggregation_node)  <span style="color:#6272a4"># èšåˆå±‚</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># è®¾ç½®å…¥å£ç‚¹</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>set_entry_point(<span style="color:#f1fa8c">&#34;master&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># å®šä¹‰å±‚æ¬¡åŒ–æ‰§è¡Œæµç¨‹ï¼ˆä¸²è¡Œå±•ç¤ºï¼Œå®é™…å¯å¹¶è¡Œä¼˜åŒ–ï¼‰</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_edge(<span style="color:#f1fa8c">&#34;master&#34;</span>, <span style="color:#f1fa8c">&#34;task_supervisor&#34;</span>)
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_edge(<span style="color:#f1fa8c">&#34;task_supervisor&#34;</span>, <span style="color:#f1fa8c">&#34;resource_supervisor&#34;</span>)
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_edge(<span style="color:#f1fa8c">&#34;resource_supervisor&#34;</span>, <span style="color:#f1fa8c">&#34;quality_supervisor&#34;</span>)
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_edge(<span style="color:#f1fa8c">&#34;quality_supervisor&#34;</span>, <span style="color:#f1fa8c">&#34;aggregation&#34;</span>)
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_edge(<span style="color:#f1fa8c">&#34;aggregation&#34;</span>, END)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> workflow<span style="color:#ff79c6">.</span>compile()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># ä½¿ç”¨ç¤ºä¾‹</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">run_hierarchical_agent</span>(task: <span style="color:#8be9fd;font-style:italic">str</span>):
</span></span><span style="display:flex;"><span>    agent <span style="color:#ff79c6">=</span> create_hierarchical_agent()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    result <span style="color:#ff79c6">=</span> agent<span style="color:#ff79c6">.</span>invoke({
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;task&#34;</span>: task,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;subtasks&#34;</span>: {},
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;worker_results&#34;</span>: {},
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;supervisor_summaries&#34;</span>: {},
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;final_result&#34;</span>: <span style="color:#ff79c6">None</span>
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> result[<span style="color:#f1fa8c">&#34;final_result&#34;</span>]
</span></span></code></pre></div><hr>
<h3 id="reflection-æ¨¡å¼">Reflection æ¨¡å¼</h3>
<h4 id="åæ€å¾ªç¯">åæ€å¾ªç¯</h4>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">graph LR
    subgraph &#34;Reflection åæ€å¾ªç¯&#34;
        A[Action&lt;br/&gt;æ‰§è¡Œè¡ŒåŠ¨]
        R[Reflect&lt;br/&gt;åæ€è¯„ä¼°]
        I[Improve&lt;br/&gt;æ”¹è¿›ç­–ç•¥]
        P[Plan&lt;br/&gt;é‡æ–°è§„åˆ’]
        
        A --&gt; R
        R --&gt; I
        I --&gt; P
        P --&gt; A
    end
    
    subgraph &#34;åæ€ç»´åº¦&#34;
        E[æ•ˆæœè¯„ä¼°]
        M[æ–¹æ³•åˆ†æ]
        G[ç›®æ ‡å¯¹é½]
        L[ç»éªŒå­¦ä¹ ]
    end
    
    R -.-&gt; E
    R -.-&gt; M
    R -.-&gt; G
    R -.-&gt; L
</code></pre><h4 id="å®ç°ç¤ºä¾‹langgraph-4">å®ç°ç¤ºä¾‹ï¼ˆLangGraphï¼‰</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">from</span> typing <span style="color:#ff79c6">import</span> TypedDict, List, Literal, Optional
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langgraph.graph <span style="color:#ff79c6">import</span> StateGraph, END
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langchain_openai <span style="color:#ff79c6">import</span> ChatOpenAI
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> langchain_core.messages <span style="color:#ff79c6">import</span> HumanMessage
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># å®šä¹‰çŠ¶æ€ç±»å‹</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">ReflectionState</span>(TypedDict):
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;&#34;&#34;Reflectionåæ€æ¨¡å¼æ™ºèƒ½ä½“çŠ¶æ€å®šä¹‰&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    task: <span style="color:#8be9fd;font-style:italic">str</span>                       <span style="color:#6272a4"># åŸå§‹ä»»åŠ¡</span>
</span></span><span style="display:flex;"><span>    current_solution: Optional[<span style="color:#8be9fd;font-style:italic">str</span>] <span style="color:#6272a4"># å½“å‰è§£å†³æ–¹æ¡ˆ</span>
</span></span><span style="display:flex;"><span>    reflection: Optional[<span style="color:#8be9fd;font-style:italic">dict</span>]      <span style="color:#6272a4"># åæ€è¯„ä¼°ç»“æœ</span>
</span></span><span style="display:flex;"><span>    improvements: List[<span style="color:#8be9fd;font-style:italic">str</span>]         <span style="color:#6272a4"># æ”¹è¿›å»ºè®®åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span>    iteration: <span style="color:#8be9fd;font-style:italic">int</span>                  <span style="color:#6272a4"># å½“å‰è¿­ä»£æ¬¡æ•°</span>
</span></span><span style="display:flex;"><span>    max_iterations: <span style="color:#8be9fd;font-style:italic">int</span>             <span style="color:#6272a4"># æœ€å¤§è¿­ä»£æ¬¡æ•°</span>
</span></span><span style="display:flex;"><span>    final_result: Optional[<span style="color:#8be9fd;font-style:italic">str</span>]     <span style="color:#6272a4"># æœ€ç»ˆç»“æœ</span>
</span></span><span style="display:flex;"><span>    quality_score: <span style="color:#8be9fd;font-style:italic">float</span>            <span style="color:#6272a4"># è´¨é‡è¯„åˆ†ï¼ˆ0-10ï¼‰</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">create_reflection_agent</span>(max_iterations: <span style="color:#8be9fd;font-style:italic">int</span> <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">3</span>, quality_threshold: <span style="color:#8be9fd;font-style:italic">float</span> <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">8.0</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    åˆ›å»ºReflectionåæ€æ¨¡å¼æ™ºèƒ½ä½“
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    è¯¥æ¨¡å¼é€šè¿‡æŒç»­çš„è‡ªæˆ‘åæ€å’Œæ”¹è¿›æ¥ä¼˜åŒ–è¾“å‡ºè´¨é‡ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    1. Action: æ‰§è¡Œä»»åŠ¡æˆ–åº”ç”¨æ”¹è¿›
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    2. Reflect: è¯„ä¼°å½“å‰æ–¹æ¡ˆçš„è´¨é‡
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    3. Improve: åˆ¶å®šæ”¹è¿›ç­–ç•¥
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    4. Plan: å†³å®šæ˜¯å¦ç»§ç»­è¿­ä»£
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    Args:
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        max_iterations: æœ€å¤§åæ€è¿­ä»£æ¬¡æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        quality_threshold: è´¨é‡é˜ˆå€¼ï¼Œè¾¾åˆ°ååœæ­¢è¿­ä»£
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    Returns:
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ç¼–è¯‘åçš„LangGraphå·¥ä½œæµ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># Actorè´Ÿè´£æ‰§è¡Œï¼ŒReflectorè´Ÿè´£è¯„ä¼°</span>
</span></span><span style="display:flex;"><span>    actor_llm <span style="color:#ff79c6">=</span> ChatOpenAI(model<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;gpt-4&#34;</span>, temperature<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0.7</span>)    <span style="color:#6272a4"># è¾ƒé«˜åˆ›é€ æ€§</span>
</span></span><span style="display:flex;"><span>    reflector_llm <span style="color:#ff79c6">=</span> ChatOpenAI(model<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;gpt-4&#34;</span>, temperature<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0</span>)  <span style="color:#6272a4"># ç²¾ç¡®è¯„ä¼°</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">action_node</span>(state: ReflectionState) <span style="color:#ff79c6">-&gt;</span> ReflectionState:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        è¡ŒåŠ¨é˜¶æ®µ (Action)
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        æ‰§è¡Œä»»åŠ¡æˆ–æ ¹æ®æ”¹è¿›å»ºè®®ä¼˜åŒ–ç°æœ‰æ–¹æ¡ˆ
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        task <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;task&#34;</span>]
</span></span><span style="display:flex;"><span>        improvements <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;improvements&#34;</span>]
</span></span><span style="display:flex;"><span>        current <span style="color:#ff79c6">=</span> state<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">&#34;current_solution&#34;</span>, <span style="color:#f1fa8c">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> current <span style="color:#ff79c6">and</span> improvements:
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4"># åº”ç”¨æ”¹è¿›å»ºè®®</span>
</span></span><span style="display:flex;"><span>            prompt <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            è¯·æ ¹æ®ä»¥ä¸‹æ”¹è¿›å»ºè®®ï¼Œä¼˜åŒ–ç°æœ‰è§£å†³æ–¹æ¡ˆï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            åŸå§‹ä»»åŠ¡ï¼š</span><span style="color:#f1fa8c">{</span>task<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            å½“å‰æ–¹æ¡ˆï¼š</span><span style="color:#f1fa8c">{</span>current<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            æ”¹è¿›å»ºè®®ï¼š</span><span style="color:#f1fa8c">{</span><span style="color:#8be9fd;font-style:italic">chr</span>(<span style="color:#bd93f9">10</span>)<span style="color:#ff79c6">.</span>join(improvements)<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            è¯·è¾“å‡ºæ”¹è¿›åçš„å®Œæ•´æ–¹æ¡ˆã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4"># é¦–æ¬¡æ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>            prompt <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            è¯·å®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            </span><span style="color:#f1fa8c">{</span>task<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            è¯·è¾“å‡ºå®Œæ•´çš„è§£å†³æ–¹æ¡ˆã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        response <span style="color:#ff79c6">=</span> actor_llm<span style="color:#ff79c6">.</span>invoke([HumanMessage(content<span style="color:#ff79c6">=</span>prompt)])
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> {<span style="color:#ff79c6">**</span>state, <span style="color:#f1fa8c">&#34;current_solution&#34;</span>: response<span style="color:#ff79c6">.</span>content}
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">reflect_node</span>(state: ReflectionState) <span style="color:#ff79c6">-&gt;</span> ReflectionState:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        åæ€é˜¶æ®µ (Reflect)
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ä»å¤šä¸ªç»´åº¦è¯„ä¼°å½“å‰æ–¹æ¡ˆï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        - æ•ˆæœè¯„ä¼° (effectiveness)
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        - æ–¹æ³•åˆ†æ (methodology)
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        - ç›®æ ‡å¯¹é½ (goal_alignment)
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        task <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;task&#34;</span>]
</span></span><span style="display:flex;"><span>        solution <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;current_solution&#34;</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        prompt <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        ä½ æ˜¯ä¸€ä¸ªä¸¥æ ¼çš„è´¨é‡è¯„ä¼°ä¸“å®¶ã€‚è¯·å¯¹ä»¥ä¸‹è§£å†³æ–¹æ¡ˆè¿›è¡Œå…¨é¢åæ€è¯„ä¼°ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        åŸå§‹ä»»åŠ¡ï¼š</span><span style="color:#f1fa8c">{</span>task<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        å½“å‰æ–¹æ¡ˆï¼š</span><span style="color:#f1fa8c">{</span>solution<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        è¯·ä»ä»¥ä¸‹ç»´åº¦è¿›è¡Œè¯„ä¼°ï¼Œè¾“å‡ºJSONæ ¼å¼ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        </span><span style="color:#f1fa8c">{{</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;effectiveness&#34;: </span><span style="color:#f1fa8c">{{</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">                &#34;score&#34;: 8,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">                &#34;analysis&#34;: &#34;æ•ˆæœè¯„ä¼°åˆ†æ&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            </span><span style="color:#f1fa8c">}}</span><span style="color:#f1fa8c">,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;methodology&#34;: </span><span style="color:#f1fa8c">{{</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">                &#34;score&#34;: 7,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">                &#34;analysis&#34;: &#34;æ–¹æ³•åˆ†æ&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            </span><span style="color:#f1fa8c">}}</span><span style="color:#f1fa8c">,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;goal_alignment&#34;: </span><span style="color:#f1fa8c">{{</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">                &#34;score&#34;: 9,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">                &#34;analysis&#34;: &#34;ç›®æ ‡å¯¹é½åº¦åˆ†æ&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            </span><span style="color:#f1fa8c">}}</span><span style="color:#f1fa8c">,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;overall_score&#34;: 8,
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;strengths&#34;: [&#34;ä¼˜ç‚¹1&#34;, &#34;ä¼˜ç‚¹2&#34;],
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">            &#34;weaknesses&#34;: [&#34;ä¸è¶³1&#34;, &#34;ä¸è¶³2&#34;]
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        </span><span style="color:#f1fa8c">}}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        response <span style="color:#ff79c6">=</span> reflector_llm<span style="color:#ff79c6">.</span>invoke([HumanMessage(content<span style="color:#ff79c6">=</span>prompt)])
</span></span><span style="display:flex;"><span>        reflection <span style="color:#ff79c6">=</span> json<span style="color:#ff79c6">.</span>loads(response<span style="color:#ff79c6">.</span>content)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">**</span>state,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;reflection&#34;</span>: reflection,
</span></span><span style="display:flex;"><span>            <span style="color:#f1fa8c">&#34;quality_score&#34;</span>: reflection<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">&#34;overall_score&#34;</span>, <span style="color:#bd93f9">0</span>)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">improve_node</span>(state: ReflectionState) <span style="color:#ff79c6">-&gt;</span> ReflectionState:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        æ”¹è¿›é˜¶æ®µ (Improve)
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        æ ¹æ®åæ€ç»“æœåˆ¶å®šå…·ä½“çš„æ”¹è¿›ç­–ç•¥
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        reflection <span style="color:#ff79c6">=</span> state[<span style="color:#f1fa8c">&#34;reflection&#34;</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        prompt <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        åŸºäºä»¥ä¸‹åæ€è¯„ä¼°ï¼Œåˆ¶å®šå…·ä½“çš„æ”¹è¿›ç­–ç•¥ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        è¯„ä¼°ç»“æœï¼š</span><span style="color:#f1fa8c">{</span>json<span style="color:#ff79c6">.</span>dumps(reflection, ensure_ascii<span style="color:#ff79c6">=</span><span style="color:#ff79c6">False</span>)<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        è¯·åˆ—å‡º3-5æ¡å…·ä½“å¯æ‰§è¡Œçš„æ”¹è¿›å»ºè®®ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        response <span style="color:#ff79c6">=</span> reflector_llm<span style="color:#ff79c6">.</span>invoke([HumanMessage(content<span style="color:#ff79c6">=</span>prompt)])
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># è§£ææ”¹è¿›å»ºè®®ï¼ˆæå–æ•°å­—å¼€å¤´çš„è¡Œï¼‰</span>
</span></span><span style="display:flex;"><span>        improvements <span style="color:#ff79c6">=</span> [line<span style="color:#ff79c6">.</span>strip() <span style="color:#ff79c6">for</span> line <span style="color:#ff79c6">in</span> response<span style="color:#ff79c6">.</span>content<span style="color:#ff79c6">.</span>split(<span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#39;</span>) 
</span></span><span style="display:flex;"><span>                       <span style="color:#ff79c6">if</span> line<span style="color:#ff79c6">.</span>strip() <span style="color:#ff79c6">and</span> line<span style="color:#ff79c6">.</span>strip()[<span style="color:#bd93f9">0</span>]<span style="color:#ff79c6">.</span>isdigit()]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> {<span style="color:#ff79c6">**</span>state, <span style="color:#f1fa8c">&#34;improvements&#34;</span>: improvements}
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">plan_node</span>(state: ReflectionState) <span style="color:#ff79c6">-&gt;</span> ReflectionState:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        è§„åˆ’é˜¶æ®µ (Plan)
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        æ›´æ–°è¿­ä»£è®¡æ•°ï¼Œä¸ºä¸‹ä¸€è½®åšå‡†å¤‡
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> {<span style="color:#ff79c6">**</span>state, <span style="color:#f1fa8c">&#34;iteration&#34;</span>: state[<span style="color:#f1fa8c">&#34;iteration&#34;</span>] <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>}
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">finalize_node</span>(state: ReflectionState) <span style="color:#ff79c6">-&gt;</span> ReflectionState:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;æœ€ç»ˆè¾“å‡º&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> {<span style="color:#ff79c6">**</span>state, <span style="color:#f1fa8c">&#34;final_result&#34;</span>: state[<span style="color:#f1fa8c">&#34;current_solution&#34;</span>]}
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">should_continue</span>(state: ReflectionState) <span style="color:#ff79c6">-&gt;</span> Literal[<span style="color:#f1fa8c">&#34;action&#34;</span>, <span style="color:#f1fa8c">&#34;finalize&#34;</span>]:
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        è·¯ç”±å‡½æ•°ï¼šå†³å®šæ˜¯å¦ç»§ç»­è¿­ä»£
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        åœæ­¢æ¡ä»¶ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        1. è´¨é‡è¯„åˆ†è¾¾åˆ°é˜ˆå€¼
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        2. è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> state[<span style="color:#f1fa8c">&#34;quality_score&#34;</span>] <span style="color:#ff79c6">&gt;=</span> quality_threshold:
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;finalize&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> state[<span style="color:#f1fa8c">&#34;iteration&#34;</span>] <span style="color:#ff79c6">&gt;=</span> state[<span style="color:#f1fa8c">&#34;max_iterations&#34;</span>]:
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;finalize&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;action&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># ===== æ„å»ºçŠ¶æ€å›¾ =====</span>
</span></span><span style="display:flex;"><span>    workflow <span style="color:#ff79c6">=</span> StateGraph(ReflectionState)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># æ·»åŠ èŠ‚ç‚¹ (A-R-I-P å¾ªç¯)</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;action&#34;</span>, action_node)      <span style="color:#6272a4"># A - è¡ŒåŠ¨</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;reflect&#34;</span>, reflect_node)    <span style="color:#6272a4"># R - åæ€</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;improve&#34;</span>, improve_node)    <span style="color:#6272a4"># I - æ”¹è¿›</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;plan&#34;</span>, plan_node)          <span style="color:#6272a4"># P - è§„åˆ’</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_node(<span style="color:#f1fa8c">&#34;finalize&#34;</span>, finalize_node)  <span style="color:#6272a4"># æœ€ç»ˆè¾“å‡º</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># è®¾ç½®å…¥å£ç‚¹</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>set_entry_point(<span style="color:#f1fa8c">&#34;action&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># å®šä¹‰åæ€å¾ªç¯: A -&gt; R -&gt; I -&gt; P</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_edge(<span style="color:#f1fa8c">&#34;action&#34;</span>, <span style="color:#f1fa8c">&#34;reflect&#34;</span>)
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_edge(<span style="color:#f1fa8c">&#34;reflect&#34;</span>, <span style="color:#f1fa8c">&#34;improve&#34;</span>)
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_edge(<span style="color:#f1fa8c">&#34;improve&#34;</span>, <span style="color:#f1fa8c">&#34;plan&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># æ¡ä»¶è¾¹ï¼šç»§ç»­å¾ªç¯æˆ–ç»“æŸ</span>
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_conditional_edges(
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;plan&#34;</span>,
</span></span><span style="display:flex;"><span>        should_continue,
</span></span><span style="display:flex;"><span>        {<span style="color:#f1fa8c">&#34;action&#34;</span>: <span style="color:#f1fa8c">&#34;action&#34;</span>, <span style="color:#f1fa8c">&#34;finalize&#34;</span>: <span style="color:#f1fa8c">&#34;finalize&#34;</span>}
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    workflow<span style="color:#ff79c6">.</span>add_edge(<span style="color:#f1fa8c">&#34;finalize&#34;</span>, END)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> workflow<span style="color:#ff79c6">.</span>compile()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># ä½¿ç”¨ç¤ºä¾‹</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">run_reflection_agent</span>(task: <span style="color:#8be9fd;font-style:italic">str</span>):
</span></span><span style="display:flex;"><span>    agent <span style="color:#ff79c6">=</span> create_reflection_agent(max_iterations<span style="color:#ff79c6">=</span><span style="color:#bd93f9">3</span>, quality_threshold<span style="color:#ff79c6">=</span><span style="color:#bd93f9">8.0</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    result <span style="color:#ff79c6">=</span> agent<span style="color:#ff79c6">.</span>invoke({
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;task&#34;</span>: task,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;current_solution&#34;</span>: <span style="color:#ff79c6">None</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;reflection&#34;</span>: <span style="color:#ff79c6">None</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;improvements&#34;</span>: [],
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;iteration&#34;</span>: <span style="color:#bd93f9">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;max_iterations&#34;</span>: <span style="color:#bd93f9">3</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;final_result&#34;</span>: <span style="color:#ff79c6">None</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;quality_score&#34;</span>: <span style="color:#bd93f9">0.0</span>
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;è¿­ä»£æ¬¡æ•°: </span><span style="color:#f1fa8c">{</span>result[<span style="color:#f1fa8c">&#39;iteration&#39;</span>]<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;è´¨é‡å¾—åˆ†: </span><span style="color:#f1fa8c">{</span>result[<span style="color:#f1fa8c">&#39;quality_score&#39;</span>]<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> result[<span style="color:#f1fa8c">&#34;final_result&#34;</span>]
</span></span></code></pre></div><hr>
<h2 id="æ¨¡å¼å¯¹æ¯”ä¸é€‰æ‹©">æ¨¡å¼å¯¹æ¯”ä¸é€‰æ‹©</h2>
<h3 id="æ ¸å¿ƒç‰¹å¾å¯¹æ¯”">æ ¸å¿ƒç‰¹å¾å¯¹æ¯”</h3>
<table>
<thead>
<tr>
<th>è®¾è®¡æ¨¡å¼</th>
<th>å¤æ‚åº¦</th>
<th>å­¦ä¹ èƒ½åŠ›</th>
<th>é€‚åº”æ€§</th>
<th>å¯è§£é‡Šæ€§</th>
<th>æ‰§è¡Œæ•ˆç‡</th>
<th>æœ€ä½³åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ReAct</strong></td>
<td>â­â­</td>
<td>â­</td>
<td>â­â­â­â­</td>
<td>â­â­â­â­â­</td>
<td>â­â­â­â­</td>
<td>åŠ¨æ€äº¤äº’ä»»åŠ¡</td>
</tr>
<tr>
<td><strong>Plan-Execute</strong></td>
<td>â­â­â­</td>
<td>â­â­</td>
<td>â­â­</td>
<td>â­â­â­</td>
<td>â­â­â­â­â­</td>
<td>å¤æ‚ç»“æ„åŒ–ä»»åŠ¡</td>
</tr>
<tr>
<td><strong>Ralph Loop</strong></td>
<td>â­â­â­â­â­</td>
<td>â­â­â­â­â­</td>
<td>â­â­â­â­â­</td>
<td>â­â­â­</td>
<td>â­â­â­</td>
<td>é•¿æœŸå­¦ä¹ ä»»åŠ¡</td>
</tr>
<tr>
<td><strong>Chain-of-Thought</strong></td>
<td>â­â­</td>
<td>â­</td>
<td>â­â­</td>
<td>â­â­â­â­â­</td>
<td>â­â­â­</td>
<td>æ¨ç†å¯†é›†ä»»åŠ¡</td>
</tr>
<tr>
<td><strong>Multi-Agent</strong></td>
<td>â­â­â­â­</td>
<td>â­â­â­</td>
<td>â­â­â­</td>
<td>â­â­â­</td>
<td>â­â­â­â­</td>
<td>åä½œå¤æ‚ä»»åŠ¡</td>
</tr>
<tr>
<td><strong>Hierarchical</strong></td>
<td>â­â­â­â­</td>
<td>â­â­</td>
<td>â­â­â­</td>
<td>â­â­</td>
<td>â­â­â­â­â­</td>
<td>å¤§è§„æ¨¡ä»»åŠ¡</td>
</tr>
<tr>
<td><strong>Reflection</strong></td>
<td>â­â­â­</td>
<td>â­â­â­â­</td>
<td>â­â­â­â­</td>
<td>â­â­â­â­</td>
<td>â­â­â­</td>
<td>è´¨é‡ä¼˜åŒ–ä»»åŠ¡</td>
</tr>
</tbody>
</table>
<h3 id="é€‰æ‹©å†³ç­–æ ‘">é€‰æ‹©å†³ç­–æ ‘</h3>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">flowchart TD
    Start[ä»»åŠ¡åˆ†æ] --&gt; Simple{ä»»åŠ¡å¤æ‚åº¦}
    
    Simple --&gt;|ç®€å•| Interactive{éœ€è¦äº¤äº’?}
    Simple --&gt;|å¤æ‚| Structured{ç»“æ„åŒ–ç¨‹åº¦}
    
    Interactive --&gt;|æ˜¯| ReAct[ReActæ¨¡å¼]
    Interactive --&gt;|å¦| CoT[Chain-of-Thoughtæ¨¡å¼]
    
    Structured --&gt;|é«˜| Parallel{å¯å¹¶è¡Œæ‰§è¡Œ?}
    Structured --&gt;|ä½| Learning{éœ€è¦å­¦ä¹ ?}
    
    Parallel --&gt;|æ˜¯| PlanExec[Plan-and-Executeæ¨¡å¼]
    Parallel --&gt;|å¦| Multi[Multi-Agentæ¨¡å¼]
    
    Learning --&gt;|æ˜¯| Ralph[Ralph Loopæ¨¡å¼]
    Learning --&gt;|å¦| Hierarchical[Hierarchicalæ¨¡å¼]
    
    style ReAct fill:#e3f2fd
    style CoT fill:#f3e5f5
    style PlanExec fill:#e8f5e8
    style Multi fill:#fff3e0
    style Ralph fill:#fce4ec
    style Hierarchical fill:#e0f2f1
</code></pre><hr>
<h2 id="å®é™…åº”ç”¨æ¡ˆä¾‹">å®é™…åº”ç”¨æ¡ˆä¾‹</h2>
<h3 id="æ¡ˆä¾‹1-æ™ºèƒ½å®¢æœç³»ç»Ÿ">æ¡ˆä¾‹1: æ™ºèƒ½å®¢æœç³»ç»Ÿ</h3>
<blockquote>
<p>[!example] åœºæ™¯æè¿°
æ„å»ºä¸€ä¸ªèƒ½å¤Ÿå¤„ç†å¤æ‚å®¢æˆ·å’¨è¯¢çš„æ™ºèƒ½å®¢æœç³»ç»Ÿ</p>
</blockquote>
<p><strong>é‡‡ç”¨æ¨¡å¼</strong>: Multi-Agent + ReAct</p>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">graph TB
    subgraph &#34;æ™ºèƒ½å®¢æœç³»ç»Ÿæ¶æ„&#34;
        Router[è·¯ç”±æ™ºèƒ½ä½“&lt;br/&gt;ReActæ¨¡å¼]
        
        subgraph &#34;ä¸“ä¸šæœåŠ¡æ™ºèƒ½ä½“&#34;
            Tech[æŠ€æœ¯æ”¯æŒ&lt;br/&gt;Plan-Execute]
            Sales[é”€å”®å’¨è¯¢&lt;br/&gt;ReAct]
            Service[å”®åæœåŠ¡&lt;br/&gt;Ralph Loop]
        end
        
        subgraph &#34;æ”¯æŒç³»ç»Ÿ&#34;
            KB[(çŸ¥è¯†åº“)]
            CRM[(å®¢æˆ·ç³»ç»Ÿ)]
            Ticket[(å·¥å•ç³»ç»Ÿ)]
        end
    end
    
    Customer[å®¢æˆ·] --&gt; Router
    Router --&gt; Tech
    Router --&gt; Sales
    Router --&gt; Service
    
    Tech &lt;--&gt; KB
    Sales &lt;--&gt; CRM
    Service &lt;--&gt; Ticket
</code></pre><h3 id="æ¡ˆä¾‹2-è‡ªåŠ¨åŒ–ç ”ç©¶åŠ©æ‰‹">æ¡ˆä¾‹2: è‡ªåŠ¨åŒ–ç ”ç©¶åŠ©æ‰‹</h3>
<blockquote>
<p>[!example] åœºæ™¯æè¿°
ååŠ©ç ”ç©¶äººå‘˜è¿›è¡Œæ–‡çŒ®è°ƒç ”å’Œå‡è®¾éªŒè¯</p>
</blockquote>
<p><strong>é‡‡ç”¨æ¨¡å¼</strong>: Ralph Loop + Chain-of-Thought</p>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">graph LR
    subgraph &#34;ç ”ç©¶åŠ©æ‰‹å·¥ä½œæµ&#34;
        Q[ç ”ç©¶é—®é¢˜] --&gt; L[æ–‡çŒ®æ£€ç´¢&lt;br/&gt;ReAct]
        L --&gt; A[æ–‡çŒ®åˆ†æ&lt;br/&gt;CoT]
        A --&gt; H[å‡è®¾ç”Ÿæˆ&lt;br/&gt;Ralph]
        H --&gt; V[å‡è®¾éªŒè¯&lt;br/&gt;Plan-Execute]
        V --&gt; R[æŠ¥å‘Šç”Ÿæˆ&lt;br/&gt;Multi-Agent]
    end
</code></pre><h3 id="æ¡ˆä¾‹3-æ™ºèƒ½ä»£ç å®¡æŸ¥">æ¡ˆä¾‹3: æ™ºèƒ½ä»£ç å®¡æŸ¥</h3>
<blockquote>
<p>[!example] åœºæ™¯æè¿°
è‡ªåŠ¨åŒ–ä»£ç è´¨é‡æ£€æŸ¥å’Œæ”¹è¿›å»ºè®®</p>
</blockquote>
<p><strong>é‡‡ç”¨æ¨¡å¼</strong>: Hierarchical + Reflection</p>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">graph TD
    subgraph &#34;ä»£ç å®¡æŸ¥ç³»ç»Ÿ&#34;
        Master[ä¸»å®¡æŸ¥æ™ºèƒ½ä½“]
        
        subgraph &#34;ä¸“é¡¹æ£€æŸ¥&#34;
            Syntax[è¯­æ³•æ£€æŸ¥]
            Logic[é€»è¾‘åˆ†æ]
            Performance[æ€§èƒ½è¯„ä¼°]
            Security[å®‰å…¨å®¡è®¡]
        end
        
        subgraph &#34;åæ€ä¼˜åŒ–&#34;
            Reflect[åæ€è¯„ä¼°]
            Improve[æ”¹è¿›å»ºè®®]
        end
    end
    
    Code[ä»£ç è¾“å…¥] --&gt; Master
    Master --&gt; Syntax
    Master --&gt; Logic
    Master --&gt; Performance
    Master --&gt; Security
    
    Syntax --&gt; Reflect
    Logic --&gt; Reflect
    Performance --&gt; Reflect
    Security --&gt; Reflect
    
    Reflect --&gt; Improve
    Improve --&gt; Report[å®¡æŸ¥æŠ¥å‘Š]
</code></pre><hr>
<h2 id="æœªæ¥å‘å±•è¶‹åŠ¿">æœªæ¥å‘å±•è¶‹åŠ¿</h2>
<h3 id="æŠ€æœ¯å‘å±•æ–¹å‘">æŠ€æœ¯å‘å±•æ–¹å‘</h3>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">mindmap
  root((æ™ºèƒ½ä½“å‘å±•è¶‹åŠ¿))
    æ¨¡å¼èåˆ
      è‡ªé€‚åº”æ¨¡å¼åˆ‡æ¢
      æ··åˆæ¶æ„è®¾è®¡
      åŠ¨æ€ç»„åˆä¼˜åŒ–
    èƒ½åŠ›å¢å¼º
      å¤šæ¨¡æ€æ„ŸçŸ¥
      è·¨åŸŸçŸ¥è¯†è¿ç§»
      å…ƒå­¦ä¹ èƒ½åŠ›
    åä½œè¿›åŒ–
      å¤§è§„æ¨¡åä½œ
      å»ä¸­å¿ƒåŒ–æ¶æ„
      é›†ç¾¤æ™ºèƒ½
    å®‰å…¨å¯æ§
      å¯è§£é‡ŠAI
      å¯¹é½æœºåˆ¶
      å®‰å…¨é˜²æŠ¤
    åº”ç”¨æ‹“å±•
      å‚ç›´é¢†åŸŸæ·±åŒ–
      è¾¹ç¼˜è®¡ç®—éƒ¨ç½²
      å®æ—¶äº¤äº’ä¼˜åŒ–
</code></pre><h3 id="å…³é”®æŠ€æœ¯çªç ´">å…³é”®æŠ€æœ¯çªç ´</h3>
<blockquote>
<p>[!note] è‡ªé€‚åº”æ¨¡å¼é€‰æ‹©</p>
<ul>
<li>åŸºäºä»»åŠ¡ç‰¹å¾çš„è‡ªåŠ¨æ¨¡å¼åŒ¹é…</li>
<li>è¿è¡Œæ—¶åŠ¨æ€æ¨¡å¼åˆ‡æ¢</li>
<li>å¤šæ¨¡å¼èåˆä¼˜åŒ–</li>
</ul>
</blockquote>
<blockquote>
<p>[!note] å¢å¼ºå­¦ä¹ æœºåˆ¶</p>
<ul>
<li>å°‘æ ·æœ¬å¿«é€Ÿå­¦ä¹ </li>
<li>æŒç»­å­¦ä¹ é˜²é—å¿˜</li>
<li>è·¨ä»»åŠ¡çŸ¥è¯†è¿ç§»</li>
</ul>
</blockquote>
<blockquote>
<p>[!note] å¤§è§„æ¨¡åä½œ</p>
<ul>
<li>åƒçº§æ™ºèƒ½ä½“åè°ƒ</li>
<li>åˆ†å¸ƒå¼å†³ç­–æœºåˆ¶</li>
<li>å®¹é”™ä¸è‡ªæ¢å¤</li>
</ul>
</blockquote>
<blockquote>
<p>[!note] å®‰å…¨ä¸å¯¹é½</p>
<ul>
<li>ä»·å€¼å¯¹é½ä¿è¯</li>
<li>è¡Œä¸ºå¯é¢„æµ‹æ€§</li>
<li>æ¶æ„è¡Œä¸ºæ£€æµ‹</li>
</ul>
</blockquote>
<h3 id="åº”ç”¨å‰æ™¯å±•æœ›">åº”ç”¨å‰æ™¯å±•æœ›</h3>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">timeline
    title æ™ºèƒ½ä½“åº”ç”¨å‘å±•æ—¶é—´çº¿
    
    2024 : åŸºç¡€æ¨¡å¼æˆç†Ÿ
         : ReActå¹¿æ³›åº”ç”¨
         : Plan-Executeå•†ä¸šåŒ–
    
    2025 : åä½œæ¨¡å¼çªç ´
         : Multi-Agentå¹³å°åŒ–
         : å‚ç›´é¢†åŸŸæ·±åŒ–
    
    2026 : å­¦ä¹ èƒ½åŠ›è·ƒå‡
         : Ralph Loopäº§ä¸šåŒ–
         : è‡ªé€‚åº”ç³»ç»Ÿæ™®åŠ
    
    2027 : å¤§è§„æ¨¡éƒ¨ç½²
         : åƒçº§æ™ºèƒ½ä½“åä½œ
         : è¾¹ç¼˜æ™ºèƒ½æ™®åŠ
    
    2028+ : é€šç”¨æ™ºèƒ½ä½“
          : è·¨åŸŸè‡ªä¸»å­¦ä¹ 
          : äººæœºæ·±åº¦åä½œ
</code></pre><hr>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<blockquote>
<p>[!summary] æ ¸å¿ƒè¦ç‚¹
æ™ºèƒ½ä½“è®¾è®¡æ¨¡å¼çš„å‘å±•ç»å†äº†ä»ç®€å•åˆ°å¤æ‚ã€ä»å•ä¸€åˆ°åä½œã€ä»å›ºå®šåˆ°è‡ªé€‚åº”çš„æ¼”è¿›è¿‡ç¨‹ã€‚æ¯ç§æ¨¡å¼éƒ½æœ‰å…¶ç‹¬ç‰¹çš„è®¾è®¡ç†å¿µå’Œé€‚ç”¨åœºæ™¯ï¼š</p>
<ul>
<li><strong>ReActæ¨¡å¼</strong>ï¼šç®€å•é«˜æ•ˆï¼Œé€‚åˆåŠ¨æ€äº¤äº’åœºæ™¯</li>
<li><strong>Plan-and-Executeæ¨¡å¼</strong>ï¼šç»“æ„åŒ–å¼ºï¼Œé€‚åˆå¤æ‚ä»»åŠ¡è§„åˆ’</li>
<li><strong>Ralph Loopæ¨¡å¼</strong>ï¼šå­¦ä¹ èƒ½åŠ›å¼ºï¼Œé€‚åˆé•¿æœŸä¼˜åŒ–ä»»åŠ¡</li>
<li><strong>æ‰©å±•æ¨¡å¼</strong>ï¼šå„æœ‰ç‰¹è‰²ï¼Œæ»¡è¶³ç‰¹å®šéœ€æ±‚</li>
</ul>
</blockquote>
<p>é€‰æ‹©åˆé€‚çš„è®¾è®¡æ¨¡å¼éœ€è¦ç»¼åˆè€ƒè™‘ä»»åŠ¡å¤æ‚åº¦ã€äº¤äº’éœ€æ±‚ã€å­¦ä¹ è¦æ±‚ã€æ€§èƒ½çº¦æŸç­‰å¤šä¸ªå› ç´ ã€‚éšç€æŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼Œæˆ‘ä»¬å¯ä»¥æœŸå¾…çœ‹åˆ°æ›´å¤šåˆ›æ–°çš„è®¾è®¡æ¨¡å¼å’Œæ›´å¼ºå¤§çš„æ™ºèƒ½ä½“ç³»ç»Ÿã€‚</p>
<p>æœªæ¥çš„æ™ºèƒ½ä½“å°†æ›´åŠ æ™ºèƒ½ã€è‡ªä¸»å’Œåä½œï¼Œèƒ½å¤Ÿåœ¨æ›´å¹¿æ³›çš„é¢†åŸŸä¸ºäººç±»æä¾›æœ‰ä»·å€¼çš„æœåŠ¡ã€‚ç†è§£å’ŒæŒæ¡è¿™äº›è®¾è®¡æ¨¡å¼ï¼Œå°†ä¸ºæ„å»ºä¸‹ä¸€ä»£AIåº”ç”¨å¥ å®šåšå®çš„åŸºç¡€ã€‚</p>
<hr>
<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2>
<ol>
<li>Yao, S., et al. (2022). &ldquo;ReAct: Synergizing Reasoning and Acting in Language Models&rdquo;</li>
<li>Wang, L., et al. (2023). &ldquo;Plan-and-Solve Prompting: Improving Zero-Shot Chain-of-Thought Reasoning&rdquo;</li>
<li>Wei, J., et al. (2022). &ldquo;Chain-of-Thought Prompting Elicits Reasoning in Large Language Models&rdquo;</li>
<li>LangChain Documentation - Agent Architectures</li>
<li>AutoGPT Project - Autonomous Agent Design Patterns</li>
<li>OpenAI. (2023). &ldquo;GPT-4 Technical Report&rdquo;</li>
<li>Anthropic. (2023). &ldquo;Constitutional AI: Harmlessness from AI Feedback&rdquo;</li>
</ol>


                
                
<div class="entry-shang text-center">
    
	    <p>ã€ŒçœŸè¯šèµèµï¼Œæ‰‹ç•™ä½™é¦™ã€</p>
	
	<button class="zs show-zs btn btn-bred">èµèµæ”¯æŒ</button>
</div>
<div class="zs-modal-bg"></div>
<div class="zs-modal-box">
	<div class="zs-modal-head">
		<button type="button" class="close">Ã—</button>
		<span class="author"><a href="https://www.iceyao.com.cn/"><img src="/img/favicon.png" />çˆ±æŠ˜è…¾çš„å·¥ç¨‹å¸ˆ</a></span>
        
	        <p class="tip"><i></i><span>çœŸè¯šèµèµï¼Œæ‰‹ç•™ä½™é¦™</span></p>
		
 
	</div>
	<div class="zs-modal-body">
		<div class="zs-modal-btns">
			<button class="btn btn-blink" data-num="2">2å…ƒ</button>
			<button class="btn btn-blink" data-num="5">5å…ƒ</button>
			<button class="btn btn-blink" data-num="10">10å…ƒ</button>
			<button class="btn btn-blink" data-num="50">50å…ƒ</button>
			<button class="btn btn-blink" data-num="100">100å…ƒ</button>
			<button class="btn btn-blink" data-num="1">ä»»æ„é‡‘é¢</button>
		</div>
		<div class="zs-modal-pay">
			<button class="btn btn-bred" id="pay-text">2å…ƒ</button>
			<p>ä½¿ç”¨<span id="pay-type">å¾®ä¿¡</span>æ‰«æäºŒç»´ç å®Œæˆæ”¯ä»˜</p>
			<img src="/img/reward/wechat-2.png"  id="pay-image"/>
		</div>
	</div>
	<div class="zs-modal-footer">
		<label><input type="radio" name="zs-type" value="wechat" class="zs-type" checked="checked"><span ><span class="zs-wechat"><img src="/img/reward/wechat-btn.png"/></span></label>
		<label><input type="radio" name="zs-type" value="alipay" class="zs-type" class="zs-alipay"><img src="/img/reward/alipay-btn.png"/></span></label>
	</div>
</div>
<script type="text/javascript" src="/js/reward.js"></script>

                

                
                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2025/04/14/mcp-readnotes/" data-toggle="tooltip" data-placement="top" title="MCPå­¦ä¹ ç¬”è®°">&larr;
                            Previous Post</a>
                    </li>
                    
                    
                </ul>
                

                


<script src="https://giscus.app/client.js"
        data-repo="yaoice/yaoice.github.io"
        data-repo-id="R_kgDOJnxqVg"
        data-category="General"
        data-category-id="DIC_kwDOJnxqVs4CWwUs"
        data-mapping="pathname"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-theme="light"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>


            </div>

            
            
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
            

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                        
                        
                        
                        
                        <a href="/tags/devops" title="devops">
                            devops
                        </a>
                        
                        
                        
                        <a href="/tags/go" title="go">
                            go
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/k8s" title="k8s">
                            k8s
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/llm" title="llm">
                            llm
                        </a>
                        
                        
                        
                        <a href="/tags/openstack" title="openstack">
                            openstack
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/tkestack" title="tkestack">
                            tkestack
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E7%BB%83%E8%BD%A6" title="ç»ƒè½¦">
                            ç»ƒè½¦
                        </a>
                        
                        
                    </div>
                </section>
                

                
                
            </div>
        </div>
    </div>
</article>





  
<script type="module">  
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs'; 
    mermaid.initialize({ startOnLoad: true });  
</script>  
<script>  
    
    Array.from(document.getElementsByClassName("language-mermaid")).forEach(  
        (el) => {  
            el.parentElement.outerHTML = `<div class="mermaid">${el.innerHTML}</div>`;  
        }  
    );  
</script>  
<style>  
       
    .mermaid svg {  
        display: block;  
        margin: auto;  
    }  
</style>  




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">                  
                    
                    <li>
                        <a href="mailto:yao3690093@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		           
                    
                    
                    
                    

		            
                    
                    <li>
                        <a target="_blank" href="/img/wechat.jpeg">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-weixin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		            
                    
                    <li>
                        <a target="_blank" href="https://github.com/yaoice">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		            
                    
                    
                    
                    
                    
                    
                    
                    
                    
            
            
            
           
                   <li>
                       <a href="/index.xml" rel="alternate" type="application/rss+xml" title="çˆ±æŠ˜è…¾çš„å·¥ç¨‹å¸ˆ" >
                           <span class="fa-stack fa-lg">
                               <i class="fas fa-circle fa-stack-2x"></i>
                               <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
                           </span>
                       </a>
                   </li>
            
             </ul>
		<p class="copyright text-muted">
                    Copyright &copy; çˆ±æŠ˜è…¾çš„å·¥ç¨‹å¸ˆ 2026
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function loadAsync(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        loadAsync("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>



<script>
    (function(){
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https'){
       bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      }
      else{
      bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>


<script>
    
    var _baId = '92c175994ded75a3cd2074bc1123e2be';

    
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?" + _baId;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script>




<script type="text/javascript">
    function generateCatalog(selector) {

        
        
        
        
            _containerSelector = 'div.post-container'
        

        
        var P = $(_containerSelector), a, n, t, l, i, c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        
        $(selector).html('')

        
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#" + $(this).prop('id');
            t = $(this).text();
            c = $('<a href="' + i + '" rel="nofollow">' + t + '</a>');
            l = $('<li class="' + n + '_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    
    $(".catalog-toggle").click((function (e) {
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    


    loadAsync("\/js\/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>







</body>
</html>
